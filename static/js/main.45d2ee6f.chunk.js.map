{"version":3,"sources":["lib/EditorManager.ts","../../resolver/dist/dist-module/index.js","lib/error.ts","lib/ResolverHostMonaco.ts","lib/bundler.worker.ts","playground/Editor.tsx","../../bundler/dist/dist-module/index.js","lib/hooks.ts","playground/Preview.tsx","playground/Sidebar.tsx","playground/Playground.tsx","templates/react.ts","serviceWorker.ts","useServiceWorker.tsx","App.tsx","index.tsx"],"names":["rootUri","Monaco","file","EditorManager","host","options","resolverHostMonaco","ResolverHostMonaco","localApi","this","getCanonicalUrl","href","a","URL","url","getResolveRoot","listEntries","entries","map","entry","type","readFileContent","decoder","TextDecoder","content","decode","worker","Worker","workerPeer","expose","connect","Transport","fromDomWorker","editor","disposableStore","DisposableStore","initialPath","viewState","WeakMap","onWillFocusModelEmitter","Emitter","onDidChangeEmitter","add","dispose","terminate","typescript","typescriptDefaults","setEagerModelSync","setMaximumWorkerIdleTime","setCompilerOptions","allowJs","allowNonTsExtensions","allowSyntheticDefaultImports","baseUrl","checkJs","esModuleInterop","experimentalDecorators","inlineSourceMap","inlineSources","isolatedModules","jsx","JsxEmit","React","lib","module","ModuleKind","CommonJS","moduleResolution","ModuleResolutionKind","NodeJs","noEmit","outDir","resolveJsonModule","rootDir","sourceMap","target","ScriptTarget","ES2015","typeRoots","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","files","pathname","createModel","onDidCreateModel","model","onDidChangePackageJson","value","getValue","dependencies","typescriptVersion","pkgJson","JSON","parse","_","invoke","addExtraLib","toString","uri","throttler","ThrottledDelayer","trigger","onDidChangeContent","language","inferLanguage","err","Error","message","getModel","getModelByHref","focusModel","setModel","lineNumber","revealLineInCenter","ScrollType","Smooth","setPosition","column","columnNumber","markers","setModelMarkers","focus","path","getModelByPath","el","create","automaticLayout","minimap","enabled","showUnused","scrollBeyondLastLine","theme","wordWrap","wrappingIndent","onDidDispose","onDidChangeModel","e","newModelUrl","get","restoreViewState","onDidBlurEditorText","saveViewState","set","focusPath","match","undefined","event","EditorManagerContext","createContext","useActiveModel","workbench","useContext","useState","activeModel","setActiveModel","useEffect","disposable","trackEditor","onDidFocusEditorText","hasTextFocus","onDidCreateEditor","ResolvedEntryKind","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","hasInvalidOptionalStringField","json","field","hasInvalidDependenciesField","every","CHAR_DOT","CHAR_FORWARD_SLASH","TRAILING_SLASH_RX","ensureTrailingSlash","replace","parseBufferAsPackageJson","spec","text","concat","error","browser","hasInvalidBrowserField","isValidPackageJson","parseTextAsPackageJson","getFirstPathSegmentAfterPrefix","child","parent","childHref","parentHref","parentOffset","charAt","slice","validateString","name","TypeError","basename","ext","start","end","matchedSlash","extIdx","firstNonSlashEnd","code","charCodeAt","isPathSeparator","extname","startDot","startPart","preDotState","dirname","len","rootEnd","offset","j","last","resolve","resolvedPath","resolvedAbsolute","allowAboveRoot","separator","res","lastSegmentLength","lastSlash","dots","lastSlashIndex","lastIndexOf","normalizeString","Decoder","buf","str","Buffer","from","EntryNotFoundError","_ExtendableError","_this2","call","_Error","ExtendableError","_this","constructor","captureStackTrace","stack","AbstractResolverHost","_resolver","Promise","TRAILING_SLASH_RX$1","Resolver","extensions","Array","defaultExtensions","packageMain","_resolve","mark","_callee","_options$invalidatedB","invalidatedBy","token","tokenSource","optionsWithDefaults","canonicalUrlPromise","_ref","_ref2","canonicalUrl","rootUrl","rootHref","rootHrefWithoutTrailingSlash","canonicalHref","resolvedUrl","_args","wrap","_context","prev","next","t0","Set","ignoreBrowserOverrides","all","sent","isCancellationRequested","startsWith","resolveAsDirectory","t1","resolveAsFile","abrupt","ignored","stop","_x","_resolveAsDirectory","_callee2","_ref3","_ref4","mainPathname","packageJsonHref","packageJsonEntry","packageJsonContent","packageJson","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","mainUrl","_context2","find","File","Symbol","iterator","done","return","finish","_x2","_x3","_resolveAsFile","_callee3","parentPackageJson","browserOverrides","browserMap","packageJsonDir","impliedUrl","targetSpec","containingUrl","filename","entryDirectoryMap","entryFileMap","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_entry","childFilename","_childFilename","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","hrefWithExtension","mapping","_match","_context3","includes","readParentPackageJson","Map","t2","Directory","t3","t4","_x4","_x5","_readParentPackageJson","_callee5","_options$invalidatedB2","hostRootUrl","hostRootHref","containingDirUrl","readPackageJsonOrRecurse","_this3","_args5","_context5","_ref5","_callee4","dir","parentPackageJsonContent","parentDir","_context4","console","warn","_x7","_x6","InvariantError","TimeoutError","TranspileError","diagnostics","getModels","reduce","modelHref","seenDirs","nestedPath","nextDirIdx","indexOf","has","encoder","TextEncoder","getTranspiledValue","output","encode","getModeId","tryLoadFromWorker","getTypeScriptWorker","workerFactory","workerClient","getEmitOutput","getSyntacticDiagnostics","emitOutput","syntacticDiagnostics","emitSkipped","fsPath","diagnostic","startPosition","getPositionAt","endPosition","flattenDiagnosticMessageText","messageText","outputFiles","attempt","promise","timeoutMs","race","timeout","then","reject","Math","pow","diag","newLine","indent","result","exports","Editor","className","useRef","editorManager","current","mount","ref","traverse","ast","ctx","visit","node","enter","leave","prop","index","_shouldSkip","shouldSkip","skipped","childKeys","isArray","skip","isArrowFunctionExpression","isFunctionDeclaration","isFunctionExpression","isIdentifier","isMemberExpression","isNodeWithStartAndEnd","isStringLiteral","isLiteral","parseFile","magicString","unboundSymbols","locals","nodeEnv","replacements","requires","requireResolves","original","onComment","_isBlock","_test","remove","onToken","addSourcemapLocation","allowReturnOutsideFunction","sourceType","scopingAndRequiresVisitor","collectGlobalsVisitor","requireDependencies","callee","requireResolveDependencies","_node","symbolName","symbolNodes","_parent","isVariableDeclaration","nextParent","kind","isScope","isBlockScope","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","declarations","declarePattern","id","_parent2","_nextParent2","_locals","declareFunction","isFunction","_locals2","isClassDeclaration","_parent3","_nextParent3","_locals3","isTryStatement","handler","_locals4","param","visitAndCaptureScoping","isIfStatement","isBinaryExpression","test","l","r","operator","left","right","memberExpressionMatches","replacement","stringify","alternate","consequent","visitAndSkipBranches","isCallExpression","firstArg","property","_firstArg","visitRequires","isPropertyOfMemberExpression","isProperty","isKeyOfProperty","isBindingIdentifier","foundBinding","declaresArguments","isThisExpression","_foundBinding","_nextParent","declaresThis","_unboundSymbols","params","isObjectPattern","properties","isArrayPattern","elements","isRestElement","argument","isAssignmentPattern","isProgram","isBlockStatement","pattern","memberParts","split","shift","RELATE_PATH_RX","SPEC_RX","Deferred","internalState","promiseResolve","promiseReject","onCancellationRequested","reason","parseBareModuleSpec","parsed","matches","String","prototype","nameSpec","maybeParseBareModuleSpec","DependencyKind","Asset","MapSet","m","valueSet","deleted","delete","size","DEFAULT_SHIM_GLOBALS","export","global","process","indentExclusionRanges","sourceMappingUrl","re","lastMatch","exec","getSourceMappingUrl","asset","endsWith","_href","cssCode","BACKSLASH","SINGLE_QUOTE","NL","CR","escaped","char","overwrite","prependRight","prepend","append","getParserForAsset","oldDependenciesByKind","acc","dep","depsByKind","resolveDetails","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","Require","references","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","_dep","RequireResolve","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","_ref7","_ref6","shim","InjectedGlobal","exportName","setCode","InvariantViolation","_ExtendableError2","NotSupportedError","_ExtendableError3","ResolveError","fromHref","NODE_CORE_SHIMS","shims","coreLibName","assign","_resolveBareModuleReference2","_resolveBareModuleReference","_callee11","resolver","bareModuleReference","_ref22","_ref22$invalidatedBy","_parseBareModuleSpec","resolvedSpec","parentUrl","parentPackageInfo","consolidatedDependencies","dependencySpec","_resolvedSpec","builtIn","_parseBareModuleSpec2","_name","_pathname","_spec","_resolvedSpec2","_args11","_context11","peerDependencies","devDependencies","createRuntime","manifest","aliases","mappings","modules","registry","logLevel","never","debug","loggerLevel","logger","_console","Runtime","root","Module","HotModule","runtime","dependents","acceptCallbacks","disposeCallbacks","seal","hot","toStringTag","configurable","alias","dependency","fromId","toId","mappingsForId","getId","init","executeEntrypoints","register","factory","_alias","entrypoint","entrypoints","require","dependent","unregister","accept","cb","bind","window","createIncrementalPrelude","Bundle","assets","entrypointsToAssets","dependenciesToAssets","assetsByHref","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","bundle","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","addSource","buildAssetForImmediateExecution","aliasMap","_ref8","_ref9","entrypointMap","_ref10","_ref11","runtimeOptions","prelude","incremental","generateSourceMap","_this$buildForImmedia","buildForImmediateExecution","toDataUri","_this4","inputMap","generateMap","includeContent","hires","seen","remapping","SourceMap","input","sourceRoot","names","sources","sourcesContent","version","_buildAssetAndCollect","clone","trim","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","resolvedHref","buildAssetAndCollectDependencies","ResolveDetailsKind","Bundler","EMPTY_MODULE_URL","noopLogger","info","resolutionCache","resolutionInvalidations","onAssetAddedEmitter","onAssetRemovedEmitter","resolveBareModule","clear","_ref12","fire","_generateBundle","_callee6","pendingOperations","incrementalAssets","dfd","enqueue","resolveHref","resolveAsset","resolveDependency","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_iterator13","_step13","invalidation","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_iterator14","_step14","resolutionCacheKey","_iteratorNormalCompletion15","_didIteratorError15","_iteratorError15","_loop","_iterator15","_step15","_this5","_args6","_context6","cancel","_ref13","op","onEnqueueAsset","onCompleteAsset","setTimeout","isSettled","catch","_ref14","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11","resolveWithDetails","_ref15","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_iterator12","_step12","getOrCreateAsset","readCode","_x8","invalidations","getValues","deleteAll","_iteratorNormalCompletion16","_didIteratorError16","_iteratorError16","_iterator16","_step16","_readCode","_callee7","_ref18","_context7","_x9","_x10","_resolveBareModuleReference3","_callee8","_ref19","_ref19$invalidatedBy","resolvedArg","resolvedUri","_args8","_context8","fetchSpec","resolveRelativeModuleReference","_x11","_x12","_resolveRelativeModuleReference","_callee9","_ref20","combinedUri","resolveResult","_context9","Relative","stableHref","stableRootHref","_x13","_x14","_x15","_resolveWithDetails","_callee10","fromUri","_ref21","_ref21$invalidatedBy","_context10","resolveBareModuleReference","_x16","_x17","_x18","EntryKind","PreviewProgress","props","total","round","completed","PreviewIframeWrap","PreviewWrap","PreviewMessageError","PreviewMessageErrorText","isInternal","PreviewMessages","PreviewMessageLine","line","PreviewMessage","lines","Preview","previewWrapRef","hmrClientRef","previewIframeRef","messages","setMessages","buildProgress","setBuildProgress","runtimeBundleString","delayer","Delayer","Throttler","building","CancellationTokenSource","queueRefreshPreview","uris","queue","refreshPreview","rerender","invalidate","runtimeBundle","unresolvedEntrypointHref","resolvedEntrypointHref","codeBundle","runtimeBundleFile","codeBundleFile","markup","createObjectURL","htmlUrl","iframe","document","createElement","style","display","src","appendChild","onload","onerror","CanceledError","hotReload","hmrClient","updatedBundleFile","updatedBundleHref","send","Event","toPromise","onReload","refreshId","Date","now","time","toInvalidate","timeEnd","onWillDisposeModel","onMessage","contentWindow","data","payload","fileName","row","getLineContent","MessagePort","HmrClient","addEventListener","removeEventListener","idx","port","onReloadEmitter","onmessage","close","postMessage","Entry","modelFocused","color","cursor","backgroundColor","CreateEntry","SidebarFileDelete","Button","StyledTooltip","SidebarFile","tooltip","useTooltipState","gutter","onClick","TooltipReference","as","role","aria-label","Tooltip","Sidebar","prefix","sortEntries","models","sort","b","initialEntries","modelUri","setEntries","findIndex","splice","useDirectory","prompt","onClickCreate","PlaygroundCmp","project","Provider","Playground","react","isLocalhost","Boolean","location","hostname","config","navigator","origin","swUrl","fetch","headers","response","contentType","status","serviceWorker","ready","registration","reload","registerValidSW","log","checkValidServiceWorker","onSuccess","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","ServiceWorkerContext","ServiceWorkerProvider","waitingServiceWorker","setWaitingServiceWorker","assetsUpdateReady","setAssetsUpdateReady","assetsCached","setAssetsCached","useMemo","updateAssets","waiting","active","PlaygroundWrapper","StatusBarItem","ReloadButton","StatusBar","context","useServiceWorker","offlineTooltip","reloadTooltip","StatusBarStyles","OfflineBolt","fontSize","Update","AppWrapper","Title","Subtitle","Link","Links","Header","globalCss","css","ReactDOM","render","CssBaseline","styles","rel","getElementById"],"mappings":"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","file":"static/js/main.45d2ee6f.chunk.js","sourcesContent":["import { ResolverHost } from '@velcro/resolver';\nimport * as Monaco from 'monaco-editor';\nimport { useState, useEffect, useContext, createContext } from 'react';\nimport { Emitter, IDisposable, DisposableStore, ThrottledDelayer } from 'ts-primitives';\n\nimport { ResolverHostMonaco } from '../lib/ResolverHostMonaco';\nimport { expose, Transport } from '@ggoodman/rpc';\n\nconst rootUri = Monaco.Uri.file('/');\n\nfunction createLocalApi(host: ResolverHost) {\n  return {\n    getCanonicalUrl: async (href: string) => {\n      const url = await host.getCanonicalUrl(null!, new URL(href));\n\n      return url.href;\n    },\n    getResolveRoot: async (href: string) => {\n      const url = await host.getResolveRoot(null!, new URL(href));\n\n      return url.href;\n    },\n    listEntries: async (href: string) => {\n      const entries = await host.listEntries(null!, new URL(href));\n\n      return entries.map(entry => ({\n        type: entry.type,\n        href: entry.url.href,\n      }));\n    },\n    readFileContent: async (href: string) => {\n      const decoder = new TextDecoder();\n      const content = await host.readFileContent(null!, new URL(href));\n\n      return decoder.decode(content);\n    },\n  };\n}\n\nexport type HostApi = ReturnType<typeof createLocalApi>;\n\nexport class EditorManager implements IDisposable {\n  private readonly resolverHostMonaco = new ResolverHostMonaco(rootUri);\n  private readonly localApi = createLocalApi(this.resolverHostMonaco);\n  private readonly worker = new Worker('./bundler.worker', { type: 'module' });\n  readonly workerPeer = expose(this.localApi).connect<import('./bundler.worker').WorkerApi>(\n    Transport.fromDomWorker(this.worker)\n  );\n\n  editor: Monaco.editor.IStandaloneCodeEditor | null = null;\n\n  private readonly disposableStore = new DisposableStore();\n  private readonly initialPath: string | undefined;\n  private readonly viewState = new WeakMap<Monaco.editor.ITextModel, Monaco.editor.ICodeEditorViewState>();\n\n  private readonly onWillFocusModelEmitter = new Emitter<Monaco.editor.ITextModel>();\n  private readonly onDidChangeEmitter = new Emitter<{ model: Monaco.editor.ITextModel }>();\n\n  constructor(options: { files?: Record<string, string>; initialPath?: string } = {}) {\n    this.disposableStore.add(this.onWillFocusModelEmitter);\n    this.disposableStore.add(this.onDidChangeEmitter);\n    this.disposableStore.add(this.workerPeer);\n    this.disposableStore.add({ dispose: () => this.worker.terminate() });\n\n    Monaco.languages.typescript.typescriptDefaults.setEagerModelSync(true);\n    Monaco.languages.typescript.typescriptDefaults.setMaximumWorkerIdleTime(-1);\n    Monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n      allowJs: true,\n      allowNonTsExtensions: true,\n      allowSyntheticDefaultImports: true,\n      baseUrl: '.',\n      checkJs: true,\n      esModuleInterop: true,\n      experimentalDecorators: true,\n      inlineSourceMap: true,\n      inlineSources: true,\n      isolatedModules: false,\n      jsx: Monaco.languages.typescript.JsxEmit.React,\n      lib: ['dom'],\n      module: Monaco.languages.typescript.ModuleKind.CommonJS,\n      moduleResolution: Monaco.languages.typescript.ModuleResolutionKind.NodeJs,\n      noEmit: false,\n      outDir: `dist`,\n      resolveJsonModule: true,\n      rootDir: '/',\n      sourceMap: true,\n      target: Monaco.languages.typescript.ScriptTarget.ES2015,\n      typeRoots: ['node_modules/@types'],\n    });\n    Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n      noSemanticValidation: true,\n      noSyntaxValidation: false,\n    });\n\n    if (options.files) {\n      for (const pathname in options.files) {\n        const content = options.files[pathname];\n\n        this.createModel(pathname, content);\n      }\n    }\n\n    Monaco.editor.onDidCreateModel(model => {\n      const onDidChangePackageJson = async () => {\n        const value = model.getValue();\n\n        let dependencies = {\n          typescript: Monaco.languages.typescript.typescriptVersion,\n        };\n\n        try {\n          const pkgJson = JSON.parse(value);\n\n          if (pkgJson.dependencies) {\n            dependencies = { ...dependencies, ...pkgJson.dependencies };\n          }\n        } catch (_) {\n          // Ignore\n        }\n\n        Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: true });\n        await this.workerPeer.invoke('importTypesForSpecs', dependencies, file => {\n          this.disposableStore.add(\n            Monaco.languages.typescript.typescriptDefaults.addExtraLib(\n              file.content,\n              Monaco.Uri.file(file.pathname).toString(true)\n            )\n          );\n        });\n        Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: false });\n      };\n\n      if (model.uri.toString(true) === `${rootUri.toString(true)}package.json`) {\n        const throttler = new ThrottledDelayer(1500);\n        throttler.trigger(onDidChangePackageJson);\n\n        this.disposableStore.add(model.onDidChangeContent(() => throttler.trigger(onDidChangePackageJson)));\n        this.disposableStore.add(throttler);\n      }\n    });\n\n    this.initialPath = options.initialPath;\n  }\n\n  get dispose() {\n    return this.disposableStore.dispose;\n  }\n\n  get onDidChange() {\n    return this.onDidChangeEmitter.event;\n  }\n\n  get onWillFocusModel() {\n    return this.onWillFocusModelEmitter.event;\n  }\n\n  createModel(pathname: string, content = '') {\n    const language = this.inferLanguage(pathname);\n\n    let uri: Monaco.Uri;\n\n    try {\n      uri = Monaco.Uri.file(pathname);\n    } catch (err) {\n      throw new Error(`Invalid path '${pathname}': ${err && err.message}`);\n    }\n\n    if (Monaco.editor.getModel(uri)) {\n      throw new Error(`Cannot create file because it exists '${pathname}'`);\n    }\n\n    return Monaco.editor.createModel(content, language, uri);\n  }\n\n  focusHref(\n    href: string,\n    options: { lineNumber?: number; columnNumber?: number; markers?: Monaco.editor.IMarkerData[] } = {}\n  ) {\n    const model = this.getModelByHref(href);\n\n    if (model) {\n      this.focusModel(model, options);\n    }\n  }\n\n  focusModel(\n    model: Monaco.editor.ITextModel,\n    options: { lineNumber?: number; columnNumber?: number; markers?: Monaco.editor.IMarkerData[] } = {}\n  ) {\n    if (this.editor) {\n      this.editor.setModel(model);\n      if (options.lineNumber) {\n        this.editor.revealLineInCenter(options.lineNumber, Monaco.editor.ScrollType.Smooth);\n        this.editor.setPosition({\n          column: options.columnNumber || 0,\n          lineNumber: options.lineNumber,\n        });\n      }\n      if (options.markers) {\n        Monaco.editor.setModelMarkers(model, 'editorManager', options.markers);\n      }\n      this.editor.focus();\n    }\n  }\n\n  focusPath(\n    path: string,\n    options: { lineNumber?: number; columnNumber?: number; markers?: Monaco.editor.IMarkerData[] } = {}\n  ) {\n    const model = this.getModelByPath(path);\n\n    if (model) {\n      this.focusModel(model, options);\n    }\n  }\n\n  getModelByHref(href: string) {\n    try {\n      const uri = Monaco.Uri.parse(href);\n      return Monaco.editor.getModel(uri);\n    } catch (_) {\n      return null;\n    }\n  }\n\n  getModelByPath(path: string) {\n    return Monaco.editor.getModel(Monaco.Uri.file(path));\n  }\n\n  mount(el: HTMLElement) {\n    if (this.editor) {\n      throw new Error('Invariant violation: Editor already mounted');\n    }\n\n    this.editor = Monaco.editor.create(el, {\n      model: null,\n      automaticLayout: true,\n      minimap: {\n        enabled: false,\n      },\n      showUnused: true,\n      scrollBeyondLastLine: false,\n      theme: 'vs',\n      wordWrap: 'bounded',\n      wrappingIndent: 'same',\n    });\n\n    this.editor.onDidDispose(() => {\n      this.editor = null;\n    });\n\n    this.editor.onDidChangeModel(e => {\n      if (e.newModelUrl && this.editor) {\n        const model = Monaco.editor.getModel(e.newModelUrl)!;\n        const viewState = this.viewState.get(model);\n\n        if (viewState) {\n          this.editor.restoreViewState(viewState);\n        }\n      }\n    });\n\n    this.editor.onDidBlurEditorText(() => {\n      if (this.editor) {\n        const model = this.editor.getModel();\n        const viewState = this.editor.saveViewState();\n\n        if (model && viewState) {\n          this.viewState.set(model, viewState);\n        }\n      }\n    });\n\n    this.disposableStore.add(this.editor);\n\n    if (this.initialPath) {\n      this.focusPath(this.initialPath);\n    }\n\n    return this.editor;\n  }\n\n  inferLanguage(pathname: string) {\n    return pathname.match(/\\.(?:tsx?|jsx?)$/) ? 'typescript' : undefined;\n  }\n}\n\nexport const EditorManagerContext = createContext(new EditorManager());\n\nexport function useActiveModel() {\n  const workbench = useContext(EditorManagerContext);\n  const [activeModel, setActiveModel] = useState<Monaco.editor.ITextModel | null>(\n    workbench.editor ? workbench.editor.getModel() : null\n  );\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n\n    const trackEditor = (editor: Monaco.editor.ICodeEditor) => {\n      editor.onDidChangeModel(e => {\n        const model = e.newModelUrl ? Monaco.editor.getModel(e.newModelUrl) : null;\n\n        setActiveModel(model);\n      });\n\n      disposable.add(\n        editor.onDidBlurEditorText(() => {\n          setActiveModel(null);\n        })\n      );\n\n      disposable.add(\n        editor.onDidFocusEditorText(() => {\n          setActiveModel(editor.getModel());\n        })\n      );\n\n      if (editor.hasTextFocus()) {\n        setActiveModel(editor.getModel());\n      }\n    };\n\n    disposable.add(Monaco.editor.onDidCreateEditor(trackEditor));\n    if (workbench.editor) {\n      trackEditor(workbench.editor);\n    }\n\n    return () => disposable.dispose();\n  }, [workbench.editor, activeModel]);\n\n  return activeModel;\n}\n","import _defineProperty from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { CancellationTokenSource, CanceledError } from 'ts-primitives';\nexport { CanceledError, CancellationToken, CancellationTokenSource } from 'ts-primitives';\nvar ResolvedEntryKind;\n\n(function (ResolvedEntryKind) {\n  ResolvedEntryKind[\"Directory\"] = \"directory\";\n  ResolvedEntryKind[\"File\"] = \"file\";\n})(ResolvedEntryKind || (ResolvedEntryKind = {}));\n\nfunction isValidPackageJson(json) {\n  return typeof json === 'object' && json !== null && !hasInvalidOptionalStringField(json, 'name') && !hasInvalidOptionalStringField(json, 'version') && !hasInvalidBrowserField(json) && !hasInvalidOptionalStringField(json, 'main') && !hasInvalidOptionalStringField(json, 'module') && !hasInvalidOptionalStringField(json, 'jsnext:main') && !hasInvalidOptionalStringField(json, 'unpkg') && !hasInvalidDependenciesField(json, 'dependencies') && !hasInvalidDependenciesField(json, 'devDependencies') && !hasInvalidDependenciesField(json, 'peerDependencies');\n}\n\nfunction hasInvalidBrowserField(json) {\n  var error = '';\n  var browser = json.browser;\n\n  if (browser) {\n    if (typeof browser === 'object') {\n      for (var key in browser) {\n        if (typeof key !== 'string') {\n          error = \"The key \".concat(key, \" of .browser must be a string\");\n          break;\n        }\n\n        if (typeof browser[key] !== 'string' && browser[key] !== false) {\n          error = \"The value \".concat(key, \" of .browser must be a string or false\");\n          break;\n        }\n      }\n    }\n  }\n\n  return error;\n}\n\nfunction hasInvalidOptionalStringField(json, field) {\n  return json[field] !== undefined && typeof json[field] !== 'string';\n}\n\nfunction hasInvalidDependenciesField(json, field) {\n  return json[field] !== undefined && typeof json[field] === 'object' && json[field] !== null && !Object.keys(json[field]).every(function (key) {\n    return typeof key === 'string' && typeof json[field][key] === 'string';\n  });\n}\n\nvar CHAR_DOT = 46;\n/* . */\n\nvar CHAR_FORWARD_SLASH = 47;\n/* / */\n\nvar TRAILING_SLASH_RX = /\\/?$/;\n\nfunction ensureTrailingSlash(pathname) {\n  return pathname.replace(TRAILING_SLASH_RX, '/');\n}\n\nfunction parseBufferAsPackageJson(decoder, content, spec) {\n  try {\n    var text = decoder.decode(content);\n    return parseTextAsPackageJson(text, spec);\n  } catch (err) {\n    throw new Error(\"Error decoding manifest buffer for package \".concat(spec, \": \").concat(err.message));\n  }\n}\n\nfunction parseTextAsPackageJson(text, spec) {\n  var json;\n\n  try {\n    json = JSON.parse(text);\n  } catch (err) {\n    throw new Error(\"Error parsing manifest as json for package \".concat(spec, \": \").concat(err.message));\n  }\n\n  if (!isValidPackageJson(json)) {\n    throw new Error(\"Invalid manifest for the package \".concat(spec));\n  }\n\n  return json;\n}\n\nfunction getFirstPathSegmentAfterPrefix(child, parent) {\n  var childHref = child.pathname;\n  var parentHref = parent.pathname;\n  var parentOffset = parentHref.charAt(parentHref.length - 1) === '/' ? -1 : 0;\n\n  for (var i = 0; i <= childHref.length; i++) {\n    if (i < parentHref.length) {\n      if (childHref.charAt(i) !== parentHref.charAt(i)) {\n        throw new Error(\"The child entry \".concat(child.href, \" does not have the pathname of \").concat(parent.href, \" as a prefix\"));\n      }\n    } else if (i === parentHref.length + parentOffset) {\n      if (childHref.charAt(i) !== '/') {\n        throw new Error(\"The child entry \".concat(child.href, \" does not have the pathname of \").concat(parent.href, \" as a prefix\"));\n      }\n    } else if (childHref.charAt(i) === '/') {\n      return childHref.slice(parentHref.length + 1 + parentOffset, i);\n    }\n  }\n\n  return childHref.slice(parentHref.length + 1 + parentOffset);\n}\n\nfunction validateString(value, name) {\n  if (typeof value !== 'string') {\n    throw new TypeError(\"The '\".concat(name, \"' argument must be of type string but got \").concat(typeof value));\n  }\n}\n\nfunction basename(path, ext) {\n  if (ext !== undefined) {\n    validateString(ext, 'ext');\n  }\n\n  validateString(path, 'path');\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n    if (ext.length === path.length && ext === path) {\n      return '';\n    }\n\n    var extIdx = ext.length - 1;\n    var firstNonSlashEnd = -1;\n\n    for (i = path.length - 1; i >= start; --i) {\n      var code = path.charCodeAt(i);\n\n      if (isPathSeparator(code)) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else {\n        if (firstNonSlashEnd === -1) {\n          // We saw the first non-path separator, remember this index in case\n          // we need it if the extension ends up not matching\n          matchedSlash = false;\n          firstNonSlashEnd = i + 1;\n        }\n\n        if (extIdx >= 0) {\n          // Try to match the explicit extension\n          if (code === ext.charCodeAt(extIdx)) {\n            if (--extIdx === -1) {\n              // We matched the extension, so mark this as the end of our path\n              // component\n              end = i;\n            }\n          } else {\n            // Extension does not match, so our result is the entire path\n            // component\n            extIdx = -1;\n            end = firstNonSlashEnd;\n          }\n        }\n      }\n    }\n\n    if (start === end) {\n      end = firstNonSlashEnd;\n    } else if (end === -1) {\n      end = path.length;\n    }\n\n    return path.slice(start, end);\n  } else {\n    for (i = path.length - 1; i >= start; --i) {\n      if (isPathSeparator(path.charCodeAt(i))) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // path component\n        matchedSlash = false;\n        end = i + 1;\n      }\n    }\n\n    if (end === -1) {\n      return '';\n    }\n\n    return path.slice(start, end);\n  }\n}\n\nfunction extname(path) {\n  validateString(path, 'path');\n  var start = 0;\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true; // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n\n  var preDotState = 0;\n\n  for (var i = path.length - 1; i >= start; --i) {\n    var code = path.charCodeAt(i);\n\n    if (isPathSeparator(code)) {\n      // If we reached a path separator that was not part of a set of path\n      // separators at the end of the string, stop now\n      if (!matchedSlash) {\n        startPart = i + 1;\n        break;\n      }\n\n      continue;\n    }\n\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n\n    if (code === CHAR_DOT) {\n      // If this is our first dot, mark it as the start of our extension\n      if (startDot === -1) {\n        startDot = i;\n      } else if (preDotState !== 1) {\n        preDotState = 1;\n      }\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 || // We saw a non-dot character immediately before the dot\n  preDotState === 0 || // The (right-most) trimmed path component is exactly '..'\n  preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n\n  return path.slice(startDot, end);\n}\n\nfunction dirname(path) {\n  validateString(path, 'path');\n  var len = path.length;\n\n  if (len === 0) {\n    return '.';\n  }\n\n  var rootEnd = -1;\n  var end = -1;\n  var matchedSlash = true;\n  var offset = 0;\n  var code = path.charCodeAt(0); // Try to match a root\n\n  if (len > 1) {\n    if (isPathSeparator(code)) {\n      // Possible UNC root\n      rootEnd = offset = 1;\n\n      if (isPathSeparator(path.charCodeAt(1))) {\n        // Matched double path separator at beginning\n        var j = 2;\n        var last = j; // Match 1 or more non-path separators\n\n        for (; j < len; ++j) {\n          if (isPathSeparator(path.charCodeAt(j))) {\n            break;\n          }\n        }\n\n        if (j < len && j !== last) {\n          // Matched!\n          last = j; // Match 1 or more path separators\n\n          for (; j < len; ++j) {\n            if (!isPathSeparator(path.charCodeAt(j))) {\n              break;\n            }\n          }\n\n          if (j < len && j !== last) {\n            // Matched!\n            last = j; // Match 1 or more non-path separators\n\n            for (; j < len; ++j) {\n              if (isPathSeparator(path.charCodeAt(j))) {\n                break;\n              }\n            }\n\n            if (j === len) {\n              // We matched a UNC root only\n              return path;\n            }\n\n            if (j !== last) {\n              // We matched a UNC root with leftovers\n              // Offset by 1 to include the separator after the UNC root to\n              // treat it as a \"normal root\" on top of a (UNC) root\n              rootEnd = offset = j + 1;\n            }\n          }\n        }\n      }\n    }\n  } else if (isPathSeparator(code)) {\n    // `path` contains just a path separator, exit early to avoid\n    // unnecessary work\n    return path;\n  }\n\n  for (var i = len - 1; i >= offset; --i) {\n    if (isPathSeparator(path.charCodeAt(i))) {\n      if (!matchedSlash) {\n        end = i;\n        break;\n      }\n    } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) {\n    if (rootEnd === -1) {\n      return '.';\n    } else {\n      end = rootEnd;\n    }\n  }\n\n  return path.slice(0, end);\n}\n\nfunction join(initialSegment) {\n  var pathname = initialSegment;\n\n  for (var i = 0; i < (arguments.length <= 1 ? 0 : arguments.length - 1); i++) {\n    var segment = i + 1 < 1 || arguments.length <= i + 1 ? undefined : arguments[i + 1];\n\n    if (segment.startsWith('/')) {\n      segment = segment.slice(1);\n    }\n\n    if (pathname.endsWith('/')) {\n      pathname += segment;\n    } else {\n      pathname += \"/\".concat(segment);\n    }\n  }\n\n  return pathname;\n}\n\nfunction resolve() {\n  var resolvedPath = '';\n  var resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = void 0;\n\n    if (i >= 0) {\n      path = i < 0 || arguments.length <= i ? undefined : arguments[i];\n    } else {\n      break;\n    }\n\n    validateString(path, 'path'); // Skip empty entries\n\n    if (path.length === 0) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n  } // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n  // Normalize the path\n\n\n  resolvedPath = normalizeString(resolvedPath, !resolvedAbsolute, '/', isPathSeparator);\n\n  if (resolvedAbsolute) {\n    if (resolvedPath.length > 0) {\n      return '/' + resolvedPath;\n    } else {\n      return '/';\n    }\n  } else if (resolvedPath.length > 0) {\n    return resolvedPath;\n  } else {\n    return '.';\n  }\n}\n\nfunction isPathSeparator(code) {\n  return code === CHAR_FORWARD_SLASH;\n}\n\nfunction normalizeString(path, allowAboveRoot, separator, isPathSeparator) {\n  var res = '';\n  var lastSegmentLength = 0;\n  var lastSlash = -1;\n  var dots = 0;\n  var code = -1;\n\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length) {\n      code = path.charCodeAt(i);\n    } else if (isPathSeparator(code)) {\n      break;\n    } else {\n      code = CHAR_FORWARD_SLASH;\n    }\n\n    if (isPathSeparator(code)) {\n      if (lastSlash === i - 1 || dots === 1) ;else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== CHAR_DOT || res.charCodeAt(res.length - 2) !== CHAR_DOT) {\n          if (res.length > 2) {\n            var lastSlashIndex = res.lastIndexOf(separator);\n\n            if (lastSlashIndex === -1) {\n              res = '';\n              lastSegmentLength = 0;\n            } else {\n              res = res.slice(0, lastSlashIndex);\n              lastSegmentLength = res.length - 1 - res.lastIndexOf(separator);\n            }\n\n            lastSlash = i;\n            dots = 0;\n            continue;\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSegmentLength = 0;\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n\n        if (allowAboveRoot) {\n          if (res.length > 0) {\n            res += \"\".concat(separator, \"..\");\n          } else {\n            res = '..';\n          }\n\n          lastSegmentLength = 2;\n        }\n      } else {\n        if (res.length > 0) {\n          res += separator + path.slice(lastSlash + 1, i);\n        } else {\n          res = path.slice(lastSlash + 1, i);\n        }\n\n        lastSegmentLength = i - lastSlash - 1;\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === CHAR_DOT && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n\n  return res;\n}\n\nvar util =\n/*#__PURE__*/\nObject.freeze({\n  ensureTrailingSlash: ensureTrailingSlash,\n  parseBufferAsPackageJson: parseBufferAsPackageJson,\n  getFirstPathSegmentAfterPrefix: getFirstPathSegmentAfterPrefix,\n  basename: basename,\n  extname: extname,\n  dirname: dirname,\n  join: join,\n  resolve: resolve\n});\n\nvar Decoder =\n/*#__PURE__*/\nfunction () {\n  function Decoder() {\n    _classCallCheck(this, Decoder);\n\n    if (typeof TextDecoder !== 'undefined') {\n      this.decoder = new TextDecoder();\n    }\n  }\n\n  _createClass(Decoder, [{\n    key: \"decode\",\n    value: function decode(buf) {\n      var str = this.decoder ? this.decoder.decode(buf) : Buffer.from(buf).toString('utf-8');\n      return str.charCodeAt(0) === 0xfeff ? str.slice(1) : str;\n    }\n  }]);\n\n  return Decoder;\n}();\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this.name = _this.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this), _this.constructor);\n    } else {\n      _this.stack = new Error(message).stack;\n    }\n\n    return _this;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar EntryNotFoundError =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(EntryNotFoundError, _ExtendableError);\n\n  function EntryNotFoundError(url) {\n    var _this2;\n\n    _classCallCheck(this, EntryNotFoundError);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(EntryNotFoundError).call(this, \"Not found \".concat(url.toString())));\n    _this2.url = url;\n    return _this2;\n  }\n\n  return EntryNotFoundError;\n}(ExtendableError);\n\nvar AbstractResolverHost =\n/*#__PURE__*/\nfunction () {\n  function AbstractResolverHost() {\n    _classCallCheck(this, AbstractResolverHost);\n  }\n\n  _createClass(AbstractResolverHost, [{\n    key: \"getCanonicalUrl\",\n    value: function getCanonicalUrl(_resolver, url) {\n      return Promise.resolve(url);\n    }\n  }]);\n\n  return AbstractResolverHost;\n}();\n\nvar TRAILING_SLASH_RX$1 = /\\/?$/;\n\nvar Resolver =\n/*#__PURE__*/\nfunction () {\n  function Resolver(host) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Resolver);\n\n    this.host = host;\n    this.decoder = new Decoder();\n    this.extensions = Array.from(options.extensions || Resolver.defaultExtensions);\n    this.packageMain = options.packageMain || ['main'];\n  }\n\n  _createClass(Resolver, [{\n    key: \"resolve\",\n    value: function () {\n      var _resolve = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(url) {\n        var options,\n            _options$invalidatedB,\n            invalidatedBy,\n            token,\n            tokenSource,\n            optionsWithDefaults,\n            canonicalUrlPromise,\n            _ref,\n            _ref2,\n            canonicalUrl,\n            rootUrl,\n            rootHref,\n            rootHrefWithoutTrailingSlash,\n            canonicalHref,\n            resolvedUrl,\n            _args = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n\n                if (url instanceof URL) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.prev = 2;\n                url = new URL(url);\n                _context.next = 9;\n                break;\n\n              case 6:\n                _context.prev = 6;\n                _context.t0 = _context[\"catch\"](2);\n                throw new Error(\"Invalid URL: \".concat(url, \": \").concat(_context.t0.message));\n\n              case 9:\n                _options$invalidatedB = options.invalidatedBy, invalidatedBy = _options$invalidatedB === void 0 ? new Set() : _options$invalidatedB;\n                token = options.token;\n\n                if (!token) {\n                  tokenSource = new CancellationTokenSource();\n                  token = tokenSource.token;\n                }\n\n                optionsWithDefaults = {\n                  extensions: options.extensions || this.extensions,\n                  ignoreBrowserOverrides: typeof options.ignoreBrowserOverrides === 'undefined' ? false : options.ignoreBrowserOverrides,\n                  invalidatedBy: invalidatedBy,\n                  packageMain: options.packageMain || this.packageMain,\n                  token: token\n                };\n                canonicalUrlPromise = this.host.getCanonicalUrl(this, url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                }); // To figure out if the url should be resolved as a file or as a directory, we need to first canonicalize the url\n                // if the host supports this and resolve the root url for the given asset.\n\n                _context.next = 16;\n                return Promise.all([canonicalUrlPromise, this.host.getResolveRoot(this, url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                })]);\n\n              case 16:\n                _ref = _context.sent;\n                _ref2 = _slicedToArray(_ref, 2);\n                canonicalUrl = _ref2[0];\n                rootUrl = _ref2[1];\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 22;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 22:\n                rootHref = rootUrl.href;\n                rootHrefWithoutTrailingSlash = rootHref.replace(TRAILING_SLASH_RX$1, '');\n                canonicalHref = canonicalUrl.href;\n\n                if (canonicalHref.startsWith(rootHrefWithoutTrailingSlash)) {\n                  _context.next = 27;\n                  break;\n                }\n\n                throw new Error(\"Unable to resolve a module whose path \".concat(canonicalHref, \" is above the host's root \").concat(rootHref));\n\n              case 27:\n                if (!(rootHrefWithoutTrailingSlash === canonicalHref || rootHref == canonicalHref)) {\n                  _context.next = 33;\n                  break;\n                }\n\n                _context.next = 30;\n                return this.resolveAsDirectory(canonicalUrl, optionsWithDefaults);\n\n              case 30:\n                _context.t1 = _context.sent;\n                _context.next = 36;\n                break;\n\n              case 33:\n                _context.next = 35;\n                return this.resolveAsFile(canonicalUrl, optionsWithDefaults);\n\n              case 35:\n                _context.t1 = _context.sent;\n\n              case 36:\n                resolvedUrl = _context.t1;\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 39;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 39:\n                return _context.abrupt(\"return\", {\n                  ignored: resolvedUrl === false,\n                  invalidatedBy: invalidatedBy,\n                  resolvedUrl: resolvedUrl || undefined,\n                  rootUrl: rootUrl\n                });\n\n              case 40:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[2, 6]]);\n      }));\n\n      function resolve(_x) {\n        return _resolve.apply(this, arguments);\n      }\n\n      return resolve;\n    }()\n    /**\r\n     * Resolve a reference treating it as a directory\r\n     *\r\n     * 1. If there is a `package.json` file and this has a `main` entry, use that\r\n     * 2. Assume `index` if no main file is found in the `package.json` manifest\r\n     *\r\n     * The outcome of this process will then be resolved as if it were a file.\r\n     */\n\n  }, {\n    key: \"resolveAsDirectory\",\n    value: function () {\n      var _resolveAsDirectory = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(url, options) {\n        var invalidatedBy, token, _ref3, _ref4, rootUrl, entries, mainPathname, packageJsonHref, packageJsonEntry, packageJsonContent, packageJson, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, packageMain, pathname, mainUrl;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                invalidatedBy = options.invalidatedBy, token = options.token; // If the enclosing directory is removed, then this file should be invalidated\n\n                invalidatedBy.add(url.href);\n                _context2.next = 4;\n                return Promise.all([this.host.getResolveRoot(this, url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                }), this.host.listEntries(this, url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                })]);\n\n              case 4:\n                _ref3 = _context2.sent;\n                _ref4 = _slicedToArray(_ref3, 2);\n                rootUrl = _ref4[0];\n                entries = _ref4[1];\n\n                if (!token.isCancellationRequested) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 10:\n                mainPathname = 'index'; // Step 1: Look for a package.json with an main field\n\n                packageJsonHref = new URL(resolve(url.pathname, './package.json'), url).href;\n                packageJsonEntry = entries.find(function (entry) {\n                  return entry.type === ResolvedEntryKind.File && entry.url.href === packageJsonHref;\n                }); // If the package.json file changes (or is created), invalidate the resolution\n\n                invalidatedBy.add(packageJsonHref);\n\n                if (!packageJsonEntry) {\n                  _context2.next = 49;\n                  break;\n                }\n\n                _context2.next = 17;\n                return this.host.readFileContent(this, packageJsonEntry.url, {\n                  token: token\n                });\n\n              case 17:\n                packageJsonContent = _context2.sent;\n\n                if (!token.isCancellationRequested) {\n                  _context2.next = 20;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 20:\n                packageJson = parseBufferAsPackageJson(this.decoder, packageJsonContent, url.href);\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context2.prev = 24;\n                _iterator = this.packageMain[Symbol.iterator]();\n\n              case 26:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context2.next = 35;\n                  break;\n                }\n\n                packageMain = _step.value;\n                pathname = packageJson[packageMain];\n\n                if (!(typeof pathname === 'string')) {\n                  _context2.next = 32;\n                  break;\n                }\n\n                mainPathname = pathname;\n                return _context2.abrupt(\"break\", 35);\n\n              case 32:\n                _iteratorNormalCompletion = true;\n                _context2.next = 26;\n                break;\n\n              case 35:\n                _context2.next = 41;\n                break;\n\n              case 37:\n                _context2.prev = 37;\n                _context2.t0 = _context2[\"catch\"](24);\n                _didIteratorError = true;\n                _iteratorError = _context2.t0;\n\n              case 41:\n                _context2.prev = 41;\n                _context2.prev = 42;\n\n                if (!_iteratorNormalCompletion && _iterator.return != null) {\n                  _iterator.return();\n                }\n\n              case 44:\n                _context2.prev = 44;\n\n                if (!_didIteratorError) {\n                  _context2.next = 47;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 47:\n                return _context2.finish(44);\n\n              case 48:\n                return _context2.finish(41);\n\n              case 49:\n                mainUrl = new URL(resolve(url.pathname, mainPathname), rootUrl);\n                return _context2.abrupt(\"return\", this.resolveAsFile(mainUrl, options));\n\n              case 51:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[24, 37, 41, 49], [42,, 44, 48]]);\n      }));\n\n      function resolveAsDirectory(_x2, _x3) {\n        return _resolveAsDirectory.apply(this, arguments);\n      }\n\n      return resolveAsDirectory;\n    }()\n    /**\r\n     * Resolve a reference treating it as a file\r\n     *\r\n     * 1. List entries in the containing directory\r\n     * 2. Look for an exact file match or a file match with one of the supplied extensions\r\n     * 3. Look for a matching child directory and attempt to resolve that as a directory\r\n     */\n\n  }, {\n    key: \"resolveAsFile\",\n    value: function () {\n      var _resolveAsFile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(url, options) {\n        var invalidatedBy, token, rootUrl, parentPackageJson, browserOverrides, browserMap, packageJsonDir, entry, impliedUrl, targetSpec, target, containingUrl, filename, entries, entryDirectoryMap, entryFileMap, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _entry, childFilename, _childFilename, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, ext, hrefWithExtension, mapping, _match, match;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(url.pathname === '' || url.pathname === '/')) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new TypeError(\"Unable to resolve the root as a file: \".concat(url.href));\n\n              case 2:\n                invalidatedBy = options.invalidatedBy, token = options.token;\n                invalidatedBy.add(url.href);\n                _context3.next = 6;\n                return this.host.getResolveRoot(this, url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                });\n\n              case 6:\n                rootUrl = _context3.sent;\n\n                if (!token.isCancellationRequested) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 9:\n                if (!(this.packageMain.includes('browser') && !options.ignoreBrowserOverrides)) {\n                  _context3.next = 15;\n                  break;\n                }\n\n                _context3.next = 12;\n                return this.readParentPackageJson(url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                });\n\n              case 12:\n                _context3.t0 = _context3.sent;\n                _context3.next = 16;\n                break;\n\n              case 15:\n                _context3.t0 = undefined;\n\n              case 16:\n                parentPackageJson = _context3.t0;\n\n                if (!token.isCancellationRequested) {\n                  _context3.next = 19;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 19:\n                browserOverrides = new Map();\n\n                if (parentPackageJson) {\n                  invalidatedBy.add(parentPackageJson.url.href);\n                }\n\n                if (!(parentPackageJson && typeof parentPackageJson.packageJson.browser === 'object')) {\n                  _context3.next = 37;\n                  break;\n                }\n\n                browserMap = parentPackageJson.packageJson.browser;\n                packageJsonDir = dirname(parentPackageJson.url.pathname);\n                _context3.t1 = _regeneratorRuntime.keys(browserMap);\n\n              case 25:\n                if ((_context3.t2 = _context3.t1()).done) {\n                  _context3.next = 37;\n                  break;\n                }\n\n                entry = _context3.t2.value;\n                impliedUrl = new URL(resolve(packageJsonDir, entry), parentPackageJson.url);\n                targetSpec = browserMap[entry];\n                target = targetSpec === false ? false : new URL(resolve(packageJsonDir, targetSpec), parentPackageJson.url);\n\n                if (!(impliedUrl.href === url.href)) {\n                  _context3.next = 34;\n                  break;\n                }\n\n                if (!(target === false)) {\n                  _context3.next = 33;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", false);\n\n              case 33:\n                return _context3.abrupt(\"return\", this.resolveAsFile(target, _objectSpread({}, options, {\n                  ignoreBrowserOverrides: true\n                })));\n\n              case 34:\n                browserOverrides.set(impliedUrl.href, target);\n                _context3.next = 25;\n                break;\n\n              case 37:\n                containingUrl = new URL(ensureTrailingSlash(dirname(url.pathname)), rootUrl);\n                invalidatedBy.add(containingUrl.href);\n                filename = basename(url.pathname);\n                _context3.next = 42;\n                return this.host.listEntries(this, containingUrl, {\n                  token: token\n                });\n\n              case 42:\n                entries = _context3.sent;\n\n                if (!token.isCancellationRequested) {\n                  _context3.next = 45;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 45:\n                entryDirectoryMap = new Map();\n                entryFileMap = new Map();\n                _iteratorNormalCompletion2 = true;\n                _didIteratorError2 = false;\n                _iteratorError2 = undefined;\n                _context3.prev = 50;\n                _iterator2 = entries[Symbol.iterator]();\n\n              case 52:\n                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n                  _context3.next = 60;\n                  break;\n                }\n\n                _entry = _step2.value;\n\n                if (!(_entry.url.href === url.href && _entry.type == ResolvedEntryKind.File)) {\n                  _context3.next = 56;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _entry.url);\n\n              case 56:\n                if (_entry.type === ResolvedEntryKind.Directory) {\n                  childFilename = getFirstPathSegmentAfterPrefix(_entry.url, containingUrl);\n                  entryDirectoryMap.set(childFilename, _entry);\n                } else if (_entry.type === ResolvedEntryKind.File) {\n                  _childFilename = basename(_entry.url.pathname);\n                  entryFileMap.set(_childFilename, _entry);\n                }\n\n              case 57:\n                _iteratorNormalCompletion2 = true;\n                _context3.next = 52;\n                break;\n\n              case 60:\n                _context3.next = 66;\n                break;\n\n              case 62:\n                _context3.prev = 62;\n                _context3.t3 = _context3[\"catch\"](50);\n                _didIteratorError2 = true;\n                _iteratorError2 = _context3.t3;\n\n              case 66:\n                _context3.prev = 66;\n                _context3.prev = 67;\n\n                if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                  _iterator2.return();\n                }\n\n              case 69:\n                _context3.prev = 69;\n\n                if (!_didIteratorError2) {\n                  _context3.next = 72;\n                  break;\n                }\n\n                throw _iteratorError2;\n\n              case 72:\n                return _context3.finish(69);\n\n              case 73:\n                return _context3.finish(66);\n\n              case 74:\n                // Look for browser overrides\n                _iteratorNormalCompletion3 = true;\n                _didIteratorError3 = false;\n                _iteratorError3 = undefined;\n                _context3.prev = 77;\n                _iterator3 = options.extensions[Symbol.iterator]();\n\n              case 79:\n                if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {\n                  _context3.next = 98;\n                  break;\n                }\n\n                ext = _step3.value;\n                hrefWithExtension = \"\".concat(url.href).concat(ext);\n                mapping = browserOverrides.get(hrefWithExtension);\n                invalidatedBy.add(hrefWithExtension);\n\n                if (!(mapping === false)) {\n                  _context3.next = 88;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", false);\n\n              case 88:\n                if (!mapping) {\n                  _context3.next = 90;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", this.resolveAsFile(mapping, _objectSpread({}, options, {\n                  ignoreBrowserOverrides: true\n                })));\n\n              case 90:\n                _match = entryFileMap.get(\"\".concat(filename).concat(ext));\n\n                if (!_match) {\n                  _context3.next = 95;\n                  break;\n                }\n\n                if (!(_match.type !== ResolvedEntryKind.File)) {\n                  _context3.next = 94;\n                  break;\n                }\n\n                return _context3.abrupt(\"continue\", 95);\n\n              case 94:\n                return _context3.abrupt(\"return\", _match.url);\n\n              case 95:\n                _iteratorNormalCompletion3 = true;\n                _context3.next = 79;\n                break;\n\n              case 98:\n                _context3.next = 104;\n                break;\n\n              case 100:\n                _context3.prev = 100;\n                _context3.t4 = _context3[\"catch\"](77);\n                _didIteratorError3 = true;\n                _iteratorError3 = _context3.t4;\n\n              case 104:\n                _context3.prev = 104;\n                _context3.prev = 105;\n\n                if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n                  _iterator3.return();\n                }\n\n              case 107:\n                _context3.prev = 107;\n\n                if (!_didIteratorError3) {\n                  _context3.next = 110;\n                  break;\n                }\n\n                throw _iteratorError3;\n\n              case 110:\n                return _context3.finish(107);\n\n              case 111:\n                return _context3.finish(104);\n\n              case 112:\n                // First, attempt to find a matching file or directory\n                match = entryDirectoryMap.get(filename);\n\n                if (!match) {\n                  _context3.next = 117;\n                  break;\n                }\n\n                if (!(match.type !== ResolvedEntryKind.Directory)) {\n                  _context3.next = 116;\n                  break;\n                }\n\n                throw new Error(\"Invariant violation \".concat(match.type, \" is unexpected\"));\n\n              case 116:\n                return _context3.abrupt(\"return\", this.resolveAsDirectory(match.url, options));\n\n              case 117:\n                throw new EntryNotFoundError(url);\n\n              case 118:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[50, 62, 66, 74], [67,, 69, 73], [77, 100, 104, 112], [105,, 107, 111]]);\n      }));\n\n      function resolveAsFile(_x4, _x5) {\n        return _resolveAsFile.apply(this, arguments);\n      }\n\n      return resolveAsFile;\n    }()\n  }, {\n    key: \"readParentPackageJson\",\n    value: function () {\n      var _readParentPackageJson = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(url) {\n        var _this3 = this;\n\n        var options,\n            _options$invalidatedB2,\n            invalidatedBy,\n            token,\n            hostRootUrl,\n            hostRootHref,\n            containingDirUrl,\n            readPackageJsonOrRecurse,\n            _args5 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                options = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {};\n                _options$invalidatedB2 = options.invalidatedBy, invalidatedBy = _options$invalidatedB2 === void 0 ? new Set() : _options$invalidatedB2, token = options.token;\n                _context5.next = 4;\n                return this.host.getCanonicalUrl(this, url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                });\n\n              case 4:\n                url = _context5.sent;\n\n                if (!(token && token.isCancellationRequested)) {\n                  _context5.next = 7;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 7:\n                _context5.next = 9;\n                return this.host.getResolveRoot(this, url, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                });\n\n              case 9:\n                hostRootUrl = _context5.sent;\n\n                if (!(token && token.isCancellationRequested)) {\n                  _context5.next = 12;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 12:\n                hostRootHref = ensureTrailingSlash(hostRootUrl.href);\n                containingDirUrl = new URL(ensureTrailingSlash(dirname(url.pathname)), url);\n\n                readPackageJsonOrRecurse =\n                /*#__PURE__*/\n                function () {\n                  var _ref5 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee4(dir) {\n                    var entries, packageJsonHref, packageJsonEntry, parentPackageJsonContent, packageJson, parentDir;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            if (dir.href.startsWith(hostRootHref)) {\n                              _context4.next = 2;\n                              break;\n                            }\n\n                            return _context4.abrupt(\"return\", undefined);\n\n                          case 2:\n                            invalidatedBy.add(dir.href);\n                            _context4.next = 5;\n                            return _this3.host.listEntries(_this3, dir, {\n                              invalidatedBy: invalidatedBy,\n                              token: token\n                            });\n\n                          case 5:\n                            entries = _context4.sent;\n\n                            if (!(token && token.isCancellationRequested)) {\n                              _context4.next = 8;\n                              break;\n                            }\n\n                            throw new CanceledError('Canceled');\n\n                          case 8:\n                            packageJsonHref = new URL(resolve(dir.pathname, './package.json'), url).href;\n                            packageJsonEntry = entries.find(function (entry) {\n                              return entry.type === ResolvedEntryKind.File && entry.url.href === packageJsonHref;\n                            });\n                            invalidatedBy.add(packageJsonHref);\n\n                            if (!packageJsonEntry) {\n                              _context4.next = 27;\n                              break;\n                            }\n\n                            _context4.prev = 12;\n                            _context4.next = 15;\n                            return _this3.host.readFileContent(_this3, packageJsonEntry.url, {\n                              invalidatedBy: invalidatedBy,\n                              token: token\n                            });\n\n                          case 15:\n                            parentPackageJsonContent = _context4.sent;\n\n                            if (!(token && token.isCancellationRequested)) {\n                              _context4.next = 18;\n                              break;\n                            }\n\n                            throw new CanceledError('Canceled');\n\n                          case 18:\n                            packageJson = parseBufferAsPackageJson(_this3.decoder, parentPackageJsonContent, packageJsonEntry.url.href);\n                            return _context4.abrupt(\"return\", {\n                              packageJson: packageJson,\n                              url: packageJsonEntry.url\n                            });\n\n                          case 22:\n                            _context4.prev = 22;\n                            _context4.t0 = _context4[\"catch\"](12);\n\n                            if (!(_context4.t0 instanceof CanceledError || _context4.t0 && _context4.t0.name === 'CanceledError')) {\n                              _context4.next = 26;\n                              break;\n                            }\n\n                            throw _context4.t0;\n\n                          case 26:\n                            console.warn(\"Error reading the parent package manifest for \".concat(url.href, \" from \").concat(packageJsonEntry.url.href, \": \").concat(_context4.t0.message));\n\n                          case 27:\n                            // Not found here, let's try one up\n                            parentDir = new URL(ensureTrailingSlash(dirname(dir.pathname)), dir); // Skip infinite recursion\n\n                            if (!(parentDir.href === dir.href)) {\n                              _context4.next = 30;\n                              break;\n                            }\n\n                            return _context4.abrupt(\"return\", undefined);\n\n                          case 30:\n                            return _context4.abrupt(\"return\", readPackageJsonOrRecurse(parentDir));\n\n                          case 31:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4, null, [[12, 22]]);\n                  }));\n\n                  return function readPackageJsonOrRecurse(_x7) {\n                    return _ref5.apply(this, arguments);\n                  };\n                }();\n\n                return _context5.abrupt(\"return\", readPackageJsonOrRecurse(containingDirUrl));\n\n              case 16:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function readParentPackageJson(_x6) {\n        return _readParentPackageJson.apply(this, arguments);\n      }\n\n      return readParentPackageJson;\n    }()\n  }]);\n\n  return Resolver;\n}();\n\nResolver.defaultExtensions = ['.js', '.jsx', '.es6', '.es', '.mjs', '.ts', '.tsx', '.json'];\nResolver.path = {\n  basename: basename,\n  dirname: dirname,\n  extname: extname,\n  resolve: resolve\n};\nexport { AbstractResolverHost, Decoder, EntryNotFoundError, ResolvedEntryKind, Resolver, isValidPackageJson, util };","export interface Diagnostic {\n  message: string;\n  start?: { lineNumber: number; column: number };\n  end?: { lineNumber: number; column: number };\n  href?: string;\n}\n\nexport class ExtendableError extends Error {\n  constructor(message?: string) {\n    super(message);\n\n    this.name = this.constructor.name;\n  }\n}\n\nexport class InvariantError extends ExtendableError {}\n\nexport class NotSupportedError extends ExtendableError {}\n\nexport class TimeoutError extends ExtendableError {}\n\nexport class TranspileError extends ExtendableError {\n  constructor(message: string, readonly diagnostics: Diagnostic[]) {\n    super(message);\n  }\n}\n","import { Resolver, ResolvedEntryKind, AbstractResolverHost, ResolvedEntry } from '@velcro/resolver';\nimport * as Monaco from 'monaco-editor';\nimport { timeout } from 'ts-primitives';\n\nimport { InvariantError, TimeoutError, TranspileError, Diagnostic } from './error';\n\nconst LANGUAGE_TYPESCRIPT = 'typescript';\nconst MAX_TRANSPILE_ATTEMPTS = 3;\nconst TRANSPILE_TIMEOUT = 2000;\nconst TRANSPILE_TIMEOUT_BACKOFF = 500;\n\ntype Model = Monaco.editor.ITextModel;\n\nexport class ResolverHostMonaco extends AbstractResolverHost {\n  constructor(private readonly rootUri: Monaco.Uri = Monaco.Uri.file('/')) {\n    super();\n  }\n\n  get rootHref() {\n    return this.rootUri.toString(true);\n  }\n\n  async getResolveRoot() {\n    return new URL(this.rootUri.toString(true));\n  }\n\n  async listEntries(_resolver: Resolver, url: URL) {\n    const href = url.href.replace(/\\/?$/, '/');\n    const rootHref = this.rootUri.toString(true);\n\n    if (!href.startsWith(rootHref)) {\n      return [];\n    }\n\n    return Monaco.editor.getModels().reduce(\n      (entries, model) => {\n        const modelHref = model.uri.toString(true);\n        const seenDirs = new Set<string>();\n\n        if (modelHref.startsWith(href)) {\n          const nestedPath = modelHref.slice(href.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const url = new URL(nestedPath.slice(0, nextDirIdx + 1), href);\n\n            if (!seenDirs.has(url.href)) {\n              entries.push({\n                type: ResolvedEntryKind.Directory,\n                url,\n              });\n            }\n          } else {\n            entries.push({\n              type: ResolvedEntryKind.File,\n              url: new URL(modelHref),\n            });\n          }\n        }\n\n        return entries;\n      },\n      [] as ResolvedEntry[]\n    );\n  }\n\n  async readFileContent(_resolver: Resolver, url: URL) {\n    const href = url.href;\n\n    if (!href.startsWith(this.rootHref)) {\n      throw new InvariantError(\n        `Attempting to read file content for a model at '${href}' outside of this host's root '${this.rootHref}'`\n      );\n    }\n\n    const pathname = href.slice(this.rootHref.length);\n    const model = Monaco.editor.getModel(Monaco.Uri.file(pathname));\n\n    if (!model) {\n      throw new InvariantError(`Attempting to read file content for a model that doesn't exist at '${href}'`);\n    }\n\n    const encoder = new TextEncoder();\n    const output = await this.getTranspiledValue(model);\n\n    return encoder.encode(output);\n  }\n\n  private async getTranspiledValue(model: Monaco.editor.ITextModel) {\n    if (model.getModeId() === LANGUAGE_TYPESCRIPT) {\n      const href = model.uri.toString(true);\n\n      const tryLoadFromWorker = async () => {\n        const workerFactory = await Monaco.languages.typescript.getTypeScriptWorker();\n        const workerClient = await workerFactory(model.uri);\n        const [emitOutput, syntacticDiagnostics] = (await Promise.all([\n          workerClient.getEmitOutput(href),\n          workerClient.getSyntacticDiagnostics(href),\n        ])) as [import('typescript').EmitOutput, import('typescript').Diagnostic[]];\n\n        if (emitOutput.emitSkipped) {\n          throw new InvariantError(`Emit skipped when trying to read '${model.uri.fsPath}'`);\n        }\n\n        if (syntacticDiagnostics.length) {\n          const diagnostics: Diagnostic[] = syntacticDiagnostics.map(diagnostic => {\n            const startPosition =\n              typeof diagnostic.start === 'number' ? model.getPositionAt(diagnostic.start) : undefined;\n            const endPosition =\n              typeof diagnostic.start === 'number' && typeof diagnostic.length === 'number'\n                ? model.getPositionAt(diagnostic.start + diagnostic.length)\n                : undefined;\n\n            return {\n              message: flattenDiagnosticMessageText(diagnostic.messageText),\n              start: startPosition ? { lineNumber: startPosition.lineNumber, column: startPosition.column } : undefined,\n              end: endPosition ? { lineNumber: endPosition.lineNumber, column: endPosition.column } : undefined,\n              href: diagnostic.source,\n            };\n          });\n          throw new TranspileError(`${syntacticDiagnostics[0].messageText} at ${model.uri.fsPath}`, diagnostics);\n        }\n\n        return emitOutput.outputFiles[0].text;\n      };\n\n      let attempt = 0;\n\n      while (attempt++ < MAX_TRANSPILE_ATTEMPTS) {\n        try {\n          const code = await raceTimeout(tryLoadFromWorker(), TRANSPILE_TIMEOUT);\n\n          return code;\n        } catch (err) {\n          if (err instanceof TimeoutError) {\n            await timeout(TRANSPILE_TIMEOUT_BACKOFF * Math.pow(2, attempt));\n            continue;\n          }\n\n          throw err;\n        }\n      }\n\n      throw new TimeoutError(`Timed out while trying to transpile '${href}'`);\n    }\n\n    return model.getValue();\n  }\n}\n\nexport function flattenDiagnosticMessageText(\n  diag: string | import('typescript').DiagnosticMessageChain | undefined,\n  newLine: string = '\\n',\n  indent = 0\n): string {\n  if (typeof diag === 'string') {\n    return diag;\n  } else if (diag === undefined) {\n    return '';\n  }\n  let result = '';\n  if (indent) {\n    result += newLine;\n\n    for (let i = 0; i < indent; i++) {\n      result += '  ';\n    }\n  }\n  result += diag.messageText;\n  indent++;\n  if (diag.next) {\n    for (const kid of diag.next) {\n      result += flattenDiagnosticMessageText(kid, newLine, indent);\n    }\n  }\n  return result;\n}\n\nfunction raceTimeout<T>(promise: Promise<T>, timeoutMs: number): Promise<T> {\n  return Promise.race([\n    promise,\n    timeout(timeoutMs).then(() => {\n      return Promise.reject(new TimeoutError());\n    }),\n  ]);\n}\n","module.exports = __webpack_public_path__ + \"static/js/0.63de61d4.chunk.worker.js\"","import styled from '@emotion/styled/macro';\nimport React, { useRef, useEffect, useContext } from 'react';\nimport { EditorManagerContext } from '../lib/EditorManager';\n\nconst Editor: React.FC<{\n  className?: string;\n}> = ({ className }) => {\n  const el = useRef<HTMLDivElement | null>(null);\n  const editorManager = useContext(EditorManagerContext);\n\n  useEffect(() => {\n    if (!el.current) {\n      return;\n    }\n\n    const editor = editorManager.mount(el.current);\n\n    return () => {\n      editor.dispose();\n    };\n  }, [editorManager, el]);\n\n  return (\n    <div className={className} ref={el}>\n      <div></div>\n    </div>\n  );\n};\n\nexport default styled(Editor)``;\n","import _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Emitter } from 'ts-primitives';\nexport { CancellationToken, CancellationTokenSource } from 'ts-primitives';\nimport MagicString, { Bundle as Bundle$1 } from 'magic-string';\nimport { parse as parse$1 } from 'acorn';\nimport { CanceledError, CancellationTokenSource } from '@velcro/resolver';\nimport { resolve } from 'npm-package-arg';\nimport remapping from '@ampproject/remapping';\nimport { Base64 } from 'js-base64';\nvar version = \"0.27.0\";\n\nfunction traverse(ast, ctx, _ref) {\n  var enter = _ref.enter,\n      leave = _ref.leave;\n  visit(ast, null, ctx, enter, leave);\n}\n\nvar shouldSkip = false;\nvar context = {\n  skip: function skip() {\n    return shouldSkip = true;\n  }\n};\nvar childKeys = {};\n\nfunction visit(node, parent, ctx, enter, leave, prop, index) {\n  if (!node) return;\n  node.parent = parent;\n\n  if (enter) {\n    var _shouldSkip = shouldSkip;\n    shouldSkip = false;\n    enter.call(context, node, parent, ctx, prop, index);\n    var skipped = shouldSkip;\n    shouldSkip = _shouldSkip;\n    if (skipped) return;\n  }\n\n  var keys = childKeys[node.type] || (childKeys[node.type] = Object.keys(node).filter(function (key) {\n    return key !== 'parent' && typeof node[key] === 'object';\n  }));\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = node[key];\n\n    if (Array.isArray(value)) {\n      for (var j = 0; j < value.length; j++) {\n        visit(value[j], node, ctx, enter, leave, key, j);\n      }\n    } else if (value && value.type) {\n      visit(value, node, ctx, enter, leave, key);\n    }\n  }\n\n  if (leave) {\n    leave(node, parent, ctx, prop, index);\n  }\n}\n\nfunction isArrowFunctionExpression(node) {\n  return node.type === 'ArrowFunctionExpression';\n}\n\nfunction isArrayPattern(node) {\n  return node.type === 'ArrayPattern';\n}\n\nfunction isAssignmentPattern(node) {\n  return node.type === 'AssignmentPattern';\n}\n\nfunction isBinaryExpression(node) {\n  return node.type === 'BinaryExpression';\n}\n\nfunction isBlockStatement(node) {\n  return node.type === 'BlockStatement';\n}\n\nfunction isCallExpression(node) {\n  return node.type === 'CallExpression';\n}\n\nfunction isClassDeclaration(node) {\n  return node.type === 'ClassDeclaration';\n}\n\nfunction isFunctionDeclaration(node) {\n  return node.type === 'FunctionDeclaration';\n}\n\nfunction isFunctionExpression(node) {\n  return node.type === 'FunctionExpression';\n}\n\nfunction isIdentifier(node) {\n  return node.type === 'Identifier';\n}\n\nfunction isIfStatement(node) {\n  return node.type === 'IfStatement';\n}\n\nfunction isLiteral(node) {\n  return node.type === 'Literal';\n}\n\nfunction isMemberExpression(node) {\n  return node.type === 'MemberExpression';\n}\n\nfunction isNodeWithStartAndEnd(node) {\n  return typeof node.start === 'number' && typeof node.end === 'number';\n}\n\nfunction isObjectPattern(node) {\n  return node.type === 'ObjectPattern';\n}\n\nfunction isProperty(node) {\n  return node.type === 'Property';\n}\n\nfunction isRestElement(node) {\n  return node.type === 'RestElement';\n}\n\nfunction isProgram(node) {\n  return node.type === 'Program';\n}\n\nfunction isThisExpression(node) {\n  return node.type === 'ThisExpression';\n}\n\nfunction isTryStatement(node) {\n  return node.type === 'TryStatement';\n}\n\nfunction isVariableDeclaration(node) {\n  return node.type === 'VariableDeclaration';\n} // Refinements or groups\n\n\nfunction isFunction(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node) || isArrowFunctionExpression(node);\n}\n\nfunction isStringLiteral(node) {\n  return isLiteral(node) && typeof node.value === 'string';\n}\n\nfunction parse(code, options) {\n  return parse$1(code, _objectSpread({}, options, {\n    allowReturnOutsideFunction: true,\n    sourceType: 'script'\n  }));\n}\n\nfunction parseFile(uri, magicString) {\n  var ctx = {\n    unboundSymbols: new Map(),\n    locals: new Map(),\n    nodeEnv: 'development',\n    replacements: [],\n    requires: [],\n    requireResolves: [],\n    skip: new Set()\n  };\n\n  try {\n    // let lastToken: acorn.Token | undefined = undefined;\n    var ast = parse(magicString.original, {\n      onComment: function onComment(_isBlock, _test, start, end) {\n        magicString.remove(start, end);\n      },\n      onToken: function onToken(token) {\n        magicString.addSourcemapLocation(token.start); // const wsStart = lastToken ? lastToken.end : 0;\n        // if (wsStart < token.start - 1) {\n        //   const between = magicString.original.substring(wsStart, token.start);\n        //   if (whitespaceRx.test(between)) {\n        //     magicString.overwrite(wsStart, token.start - 1, ' ');\n        //   }\n        // }\n        // lastToken = token;\n      }\n    });\n    traverse(ast, ctx, scopingAndRequiresVisitor);\n    traverse(ast, ctx, collectGlobalsVisitor);\n  } catch (err) {\n    throw new Error(\"Error parsing \".concat(uri, \": \").concat(err.message));\n  }\n\n  var requireDependencies = [];\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = ctx.requires[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var node = _step.value;\n      requireDependencies.push({\n        callee: _objectSpread({}, node.callee),\n        spec: _objectSpread({}, node.spec)\n      });\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  var requireResolveDependencies = [];\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = ctx.requireResolves[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var _node = _step2.value;\n      requireResolveDependencies.push({\n        callee: _objectSpread({}, _node.callee),\n        spec: _objectSpread({}, _node.spec)\n      });\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  var unboundSymbols = new Map();\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = ctx.unboundSymbols[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var _ref4 = _step3.value;\n\n      var _ref3 = _slicedToArray(_ref4, 2);\n\n      var symbolName = _ref3[0];\n      var symbolNodes = _ref3[1];\n      unboundSymbols.set(symbolName, symbolNodes.map(function (node) {\n        return {\n          start: node.start,\n          end: node.end\n        };\n      }));\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n\n  return {\n    requireDependencies: requireDependencies,\n    requireResolveDependencies: requireResolveDependencies,\n    unboundSymbols: unboundSymbols\n  };\n}\n\nvar scopingAndRequiresVisitor = {\n  enter: function enter(node, parent, ctx) {\n    if (ctx.skip.has(node)) {\n      return this.skip();\n    }\n\n    visitAndCaptureScoping(node, parent, ctx);\n    visitAndSkipBranches(node, parent, ctx);\n    visitRequires(node, parent, ctx);\n  }\n};\nvar collectGlobalsVisitor = {\n  enter: function enter(node, _parent, ctx) {\n    if (isBindingIdentifier(node) && isIdentifier(node)) {\n      var name = node.name;\n      if (name === 'undefined') return;\n      var foundBinding = false;\n      var nextParent = node.parent;\n\n      while (nextParent) {\n        if (name === 'arguments' && declaresArguments(nextParent)) {\n          foundBinding = true;\n          break;\n        }\n\n        var locals = ctx.locals.get(nextParent);\n\n        if (locals && locals[name]) {\n          foundBinding = true;\n          break;\n        }\n\n        nextParent = nextParent.parent;\n      }\n\n      if (!foundBinding && isNodeWithStartAndEnd(node)) {\n        var unboundSymbols = ctx.unboundSymbols.get(name);\n\n        if (!unboundSymbols) {\n          unboundSymbols = [];\n          ctx.unboundSymbols.set(name, unboundSymbols);\n        }\n\n        unboundSymbols.push(node);\n      }\n    } else if (isThisExpression(node)) {\n      var _foundBinding = false;\n      var _nextParent = node.parent;\n\n      while (_nextParent) {\n        if (declaresThis(_nextParent)) {\n          _foundBinding = true;\n          break;\n        }\n\n        _nextParent = _nextParent.parent;\n      }\n\n      if (!_foundBinding && isNodeWithStartAndEnd(node)) {\n        var _unboundSymbols = ctx.unboundSymbols.get('this');\n\n        if (!_unboundSymbols) {\n          _unboundSymbols = [];\n          ctx.unboundSymbols.set('this', _unboundSymbols);\n        }\n\n        _unboundSymbols.push(node);\n      }\n    }\n  }\n};\n\nfunction visitAndCaptureScoping(node, _parent, ctx) {\n  if (isVariableDeclaration(node)) {\n    var parent;\n    var nextParent = node.parent;\n\n    while (nextParent) {\n      if (node.kind === 'var' ? isScope(nextParent) : isBlockScope(nextParent)) {\n        parent = nextParent;\n        break;\n      }\n\n      nextParent = nextParent.parent;\n    }\n\n    if (!parent) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var locals = ctx.locals.get(parent);\n\n    if (!locals) {\n      locals = {};\n      ctx.locals.set(parent, locals);\n    }\n\n    var _iteratorNormalCompletion4 = true;\n    var _didIteratorError4 = false;\n    var _iteratorError4 = undefined;\n\n    try {\n      for (var _iterator4 = node.declarations[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n        var declaration = _step4.value;\n        declarePattern(declaration.id, locals);\n      }\n    } catch (err) {\n      _didIteratorError4 = true;\n      _iteratorError4 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n          _iterator4.return();\n        }\n      } finally {\n        if (_didIteratorError4) {\n          throw _iteratorError4;\n        }\n      }\n    }\n  } else if (isFunctionDeclaration(node)) {\n    var _parent2;\n\n    var _nextParent2 = node.parent;\n\n    if (_nextParent2 && _nextParent2.parent) {\n      _nextParent2 = _nextParent2.parent;\n    }\n\n    while (_nextParent2) {\n      if (isScope(_nextParent2)) {\n        _parent2 = _nextParent2;\n        break;\n      }\n\n      _nextParent2 = _nextParent2.parent;\n    }\n\n    if (!_parent2) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var _locals = ctx.locals.get(_parent2);\n\n    if (!_locals) {\n      _locals = {};\n      ctx.locals.set(_parent2, _locals);\n    }\n\n    declareFunction(node, _locals);\n  } else if (isFunction(node)) {\n    var _locals2 = ctx.locals.get(node);\n\n    if (!_locals2) {\n      _locals2 = {};\n      ctx.locals.set(node, _locals2);\n    }\n\n    declareFunction(node, _locals2);\n  } else if (isClassDeclaration(node) && node.id) {\n    var _parent3;\n\n    var _nextParent3 = node.parent;\n\n    if (_nextParent3 && _nextParent3.parent) {\n      _nextParent3 = _nextParent3.parent;\n    }\n\n    while (_nextParent3) {\n      if (isScope(_nextParent3)) {\n        _parent3 = _nextParent3;\n        break;\n      }\n\n      _nextParent3 = _nextParent3.parent;\n    }\n\n    if (!_parent3) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var _locals3 = ctx.locals.get(_parent3);\n\n    if (!_locals3) {\n      _locals3 = {};\n      ctx.locals.set(_parent3, _locals3);\n    }\n\n    _locals3[node.id.name] = true;\n  } else if (isTryStatement(node)) {\n    if (node.handler) {\n      var _locals4 = ctx.locals.get(node.handler);\n\n      if (!_locals4) {\n        _locals4 = {};\n        ctx.locals.set(node.handler, _locals4);\n      }\n\n      declarePattern(node.handler.param, _locals4);\n    }\n  }\n}\n\nfunction visitAndSkipBranches(node, _parent, ctx) {\n  if (isIfStatement(node) && isBinaryExpression(node.test)) {\n    var tests = {\n      '!=': function _(l, r) {\n        return l != r;\n      },\n      '!==': function _(l, r) {\n        return l !== r;\n      },\n      '==': function _(l, r) {\n        return l == r;\n      },\n      '===': function _(l, r) {\n        return l === r;\n      }\n    };\n    var test = tests[node.test.operator];\n\n    if (test) {\n      if (isStringLiteral(node.test.left) && isMemberExpression(node.test.right) && memberExpressionMatches(node.test.right, 'process.env.NODE_ENV')) {\n        // if ('development' === process.env.NODE_ENV) {}\n        ctx.replacements.push({\n          start: node.test.right.start,\n          end: node.test.right.end,\n          replacement: JSON.stringify(ctx.nodeEnv)\n        });\n\n        if (!test(node.test.left.value, ctx.nodeEnv)) {\n          ctx.skip.add(node.consequent);\n        } else if (node.alternate) {\n          ctx.skip.add(node.alternate);\n        }\n      } else if (isStringLiteral(node.test.right) && isMemberExpression(node.test.left) && memberExpressionMatches(node.test.left, 'process.env.NODE_ENV')) {\n        // if (process.env.NODE_ENV === 'development') {}\n        ctx.replacements.push({\n          start: node.test.left.start,\n          end: node.test.left.end,\n          replacement: JSON.stringify(ctx.nodeEnv)\n        });\n\n        if (!test(node.test.right.value, ctx.nodeEnv)) {\n          ctx.skip.add(node.consequent);\n        } else if (node.alternate) {\n          ctx.skip.add(node.alternate);\n        }\n      }\n    }\n  }\n}\n\nfunction visitRequires(node, _parent, ctx) {\n  if (isCallExpression(node) && isNodeWithStartAndEnd(node.callee)) {\n    var callee = node.callee;\n\n    if (isIdentifier(callee) && isNodeWithStartAndEnd(callee) && callee.name === 'require') {\n      var firstArg = node.arguments[0];\n\n      if (isStringLiteral(firstArg) && isNodeWithStartAndEnd(firstArg)) {\n        ctx.requires.push({\n          spec: {\n            start: firstArg.start,\n            end: firstArg.end,\n            value: firstArg.value\n          },\n          callee: {\n            start: callee.start,\n            end: callee.end\n          }\n        });\n      } else {\n        console.warn('Non string-literal first arg to require', firstArg);\n      }\n    } else if (isMemberExpression(callee) && isIdentifier(callee.object) && callee.object.name === 'require' && isIdentifier(callee.property) && callee.property.name === 'resolve') {\n      var _firstArg = node.arguments[0];\n\n      if (isStringLiteral(_firstArg) && isNodeWithStartAndEnd(_firstArg)) {\n        ctx.requireResolves.push({\n          spec: {\n            start: _firstArg.start,\n            end: _firstArg.end,\n            value: _firstArg.value\n          },\n          callee: {\n            start: callee.start,\n            end: callee.end\n          }\n        });\n      } else {\n        console.warn('Non string-literal first arg to require.resolve', _firstArg);\n      }\n    }\n  }\n}\n\nfunction declareFunction(node, locals) {\n  node.params.forEach(function (node) {\n    declarePattern(node, locals);\n  });\n\n  if (node.id) {\n    locals[node.id.name] = true;\n  }\n}\n\nfunction declarePattern(node, locals) {\n  if (isIdentifier(node)) {\n    locals[node.name] = true;\n  } else if (isObjectPattern(node)) {\n    node.properties.forEach(function (node) {\n      return declarePattern(node.value, locals);\n    });\n  } else if (isArrayPattern(node)) {\n    node.elements.forEach(function (node) {\n      return node && declarePattern(node, locals);\n    });\n  } else if (isRestElement(node)) {\n    declarePattern(node.argument, locals);\n  } else if (isAssignmentPattern(node)) {\n    declarePattern(node.left, locals);\n  } else {\n    throw new Error(\"Invariant violation: Unexpected pattern type: \".concat(node.type));\n  }\n}\n\nfunction isBindingIdentifier(node) {\n  return isIdentifier(node) && !isPropertyOfMemberExpression(node) && !isKeyOfProperty(node);\n}\n\nfunction isKeyOfProperty(node) {\n  return node.parent && isProperty(node.parent) && node.parent.key === node;\n}\n\nfunction isPropertyOfMemberExpression(node) {\n  return node.parent && isMemberExpression(node.parent) && node.parent.object !== node;\n}\n\nfunction isScope(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node) || isArrowFunctionExpression(node) || isProgram(node);\n}\n\nfunction isBlockScope(node) {\n  return isBlockStatement(node) || isScope(node);\n}\n\nfunction declaresArguments(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node);\n}\n\nfunction declaresThis(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node);\n}\n\nfunction memberExpressionMatches(node, pattern) {\n  var memberParts = pattern.split('.');\n\n  if (memberParts.length < 2) {\n    return false;\n  }\n\n  var object = memberParts.shift();\n  var property = memberParts.shift();\n\n  for (var i = memberParts.length - 1; i >= 0; i--) {\n    if (!isIdentifier(node.property) || node.property.name !== memberParts[i]) {\n      return false;\n    }\n\n    if (!isMemberExpression(node.object)) {\n      return false;\n    }\n\n    node = node.object;\n  }\n\n  if (!isIdentifier(node.object) || !isIdentifier(node.property)) {\n    return false;\n  }\n\n  return node.object.name === object && node.property.name === property;\n}\n\nvar RELATE_PATH_RX = /^[./]|^[a-z_-]+:/;\nvar SPEC_RX = /^((@[^/]+\\/[^/@]+|[^./@][^/@]*)(?:@([^/]+))?)(.*)?$/;\n\nvar Deferred =\n/*#__PURE__*/\nfunction () {\n  function Deferred(token) {\n    var _this = this;\n\n    _classCallCheck(this, Deferred);\n\n    this.internalState = 'pending';\n    this.promise = new Promise(function (promiseResolve, promiseReject) {\n      _this.promiseResolve = promiseResolve;\n      _this.promiseReject = promiseReject;\n    });\n\n    if (token) {\n      if (token.isCancellationRequested) {\n        this.reject(new CanceledError('Canceled'));\n      } else {\n        token.onCancellationRequested(function () {\n          _this.reject(new CanceledError('Canceled'));\n        });\n      }\n    }\n  }\n\n  _createClass(Deferred, [{\n    key: \"resolve\",\n    value: function resolve(value) {\n      this.internalState = 'resolved';\n      this.promiseResolve(value);\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(reason) {\n      this.internalState = 'rejected';\n      this.promiseReject(reason);\n    }\n  }, {\n    key: \"isSettled\",\n    get: function get() {\n      return this.internalState !== 'pending';\n    }\n  }, {\n    key: \"state\",\n    get: function get() {\n      return this.internalState;\n    }\n  }]);\n\n  return Deferred;\n}();\n\nfunction isBareModuleSpecifier(spec) {\n  return !RELATE_PATH_RX.test(spec);\n}\n\nfunction maybeParseBareModuleSpec(spec) {\n  /**\r\n   * 1: scope + name + version\r\n   * 2: scope + name\r\n   * 3: version?\r\n   * 4: pathname\r\n   */\n  var matches = String.prototype.match.call(spec, SPEC_RX);\n\n  if (!matches) {\n    return undefined;\n  }\n\n  return {\n    nameSpec: matches[1],\n    name: matches[2],\n    spec: matches[3] || '',\n    pathname: matches[4] || ''\n  };\n}\n\nfunction parseBareModuleSpec(spec) {\n  var parsed = maybeParseBareModuleSpec(spec);\n\n  if (!parsed) {\n    throw new Error(\"Unable to parse unexpected unpkg url: '\".concat(spec, \"'\"));\n  }\n\n  return parsed;\n} // this looks ridiculous, but it prevents sourcemap tooling from mistaking\n// this for an actual sourceMappingURL\n\n\nfunction getSourceMappingUrl(str) {\n  var re = /(?:\\/\\/[@#][\\s]*(?:source)MappingURL=([^\\s'\"]+)[\\s]*$)|(?:\\/\\*[@#][\\s]*(?:source)MappingURL=([^\\s*'\"]+)[\\s]*(?:\\*\\/)[\\s]*$)/gm; // Keep executing the search to find the *last* sourceMappingURL to avoid\n  // picking up sourceMappingURLs from comments, strings, etc.\n\n  var lastMatch = null;\n  var match;\n\n  while (match = re.exec(str)) {\n    lastMatch = match;\n  }\n\n  if (!lastMatch) return null;\n  return lastMatch[1];\n}\n\nvar MapSet =\n/*#__PURE__*/\nfunction () {\n  function MapSet() {\n    _classCallCheck(this, MapSet);\n\n    this.m = new Map();\n  }\n\n  _createClass(MapSet, [{\n    key: \"add\",\n    value: function add(key, value) {\n      var valueSet = this.m.get(key);\n\n      if (!valueSet) {\n        valueSet = new Set();\n        this.m.set(key, valueSet);\n      }\n\n      valueSet.add(value);\n      return this;\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(key, value) {\n      var valueSet = this.m.get(key);\n      var deleted = false;\n\n      if (valueSet) {\n        deleted = valueSet.delete(value);\n\n        if (deleted && !valueSet.size) {\n          this.m.delete(key);\n        }\n      }\n\n      return deleted;\n    }\n  }, {\n    key: \"deleteAll\",\n    value: function deleteAll(key) {\n      return this.m.delete(key);\n    }\n  }, {\n    key: \"getValues\",\n    value: function getValues(key) {\n      return new Set(this.m.get(key));\n    }\n  }, {\n    key: \"has\",\n    value: function has(key, value) {\n      var valueSet = this.m.get(key);\n      return valueSet ? valueSet.has(value) : false;\n    }\n  }]);\n\n  return MapSet;\n}();\n\nvar DEFAULT_SHIM_GLOBALS = {\n  Buffer: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/buffer.js\"),\n    export: 'Buffer'\n  },\n  global: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/global.js\")\n  },\n  process: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/process.js\")\n  }\n};\n\nvar Asset =\n/*#__PURE__*/\nfunction () {\n  function Asset(href, rootHref) {\n    _classCallCheck(this, Asset);\n\n    this.href = href;\n    this.rootHref = rootHref;\n    this.dependencies = undefined;\n  }\n\n  _createClass(Asset, [{\n    key: \"setCode\",\n    value: function setCode(code) {\n      this.magicString = new MagicString(code, {\n        filename: this.href,\n        indentExclusionRanges: []\n      });\n      this.sourceMappingUrl = getSourceMappingUrl(code);\n      var parser = getParserForAsset(this);\n      var dependencies = parser.parse(this.href, this.magicString);\n      var oldDependenciesByKind = (this.dependencies || []).reduce(function (acc, dep) {\n        var depsByKind = acc[dep.type];\n\n        if (!depsByKind) {\n          depsByKind = {};\n          acc[dep.type] = depsByKind;\n        }\n\n        depsByKind[dep.value] = dep.resolveDetails;\n        return acc;\n      }, {});\n      this.dependencies = [];\n      var _iteratorNormalCompletion5 = true;\n      var _didIteratorError5 = false;\n      var _iteratorError5 = undefined;\n\n      try {\n        for (var _iterator5 = dependencies.requireDependencies[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n          var dep = _step5.value;\n          this.dependencies.push({\n            type: Asset.DependencyKind.Require,\n            callee: dep.callee,\n            references: [{\n              start: dep.spec.start,\n              end: dep.spec.end\n            }],\n            value: dep.spec.value,\n            resolveDetails: oldDependenciesByKind[Asset.DependencyKind.Require] ? oldDependenciesByKind[Asset.DependencyKind.Require][dep.spec.value] : undefined\n          });\n        }\n      } catch (err) {\n        _didIteratorError5 = true;\n        _iteratorError5 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion5 && _iterator5.return != null) {\n            _iterator5.return();\n          }\n        } finally {\n          if (_didIteratorError5) {\n            throw _iteratorError5;\n          }\n        }\n      }\n\n      var _iteratorNormalCompletion6 = true;\n      var _didIteratorError6 = false;\n      var _iteratorError6 = undefined;\n\n      try {\n        for (var _iterator6 = dependencies.requireResolveDependencies[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n          var _dep = _step6.value;\n          this.dependencies.push({\n            type: Asset.DependencyKind.RequireResolve,\n            callee: _dep.callee,\n            references: [{\n              start: _dep.spec.start,\n              end: _dep.spec.end\n            }],\n            value: _dep.spec.value,\n            resolveDetails: oldDependenciesByKind[Asset.DependencyKind.RequireResolve] ? oldDependenciesByKind[Asset.DependencyKind.RequireResolve][_dep.spec.value] : undefined\n          });\n        }\n      } catch (err) {\n        _didIteratorError6 = true;\n        _iteratorError6 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion6 && _iterator6.return != null) {\n            _iterator6.return();\n          }\n        } finally {\n          if (_didIteratorError6) {\n            throw _iteratorError6;\n          }\n        }\n      }\n\n      var _iteratorNormalCompletion7 = true;\n      var _didIteratorError7 = false;\n      var _iteratorError7 = undefined;\n\n      try {\n        for (var _iterator7 = dependencies.unboundSymbols[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n          var _ref7 = _step7.value;\n\n          var _ref6 = _slicedToArray(_ref7, 2);\n\n          var symbolName = _ref6[0];\n          var references = _ref6[1];\n          var shim = DEFAULT_SHIM_GLOBALS[symbolName];\n\n          if (shim) {\n            var value = \"\".concat(shim.spec).concat(shim.export ? \"[\".concat(JSON.stringify(shim.export), \"]\") : '');\n            this.dependencies.push({\n              type: Asset.DependencyKind.InjectedGlobal,\n              exportName: shim.export,\n              references: references,\n              symbolName: symbolName,\n              value: value,\n              resolveDetails: oldDependenciesByKind[Asset.DependencyKind.InjectedGlobal] ? oldDependenciesByKind[Asset.DependencyKind.InjectedGlobal][value] : undefined\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError7 = true;\n        _iteratorError7 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion7 && _iterator7.return != null) {\n            _iterator7.return();\n          }\n        } finally {\n          if (_didIteratorError7) {\n            throw _iteratorError7;\n          }\n        }\n      }\n\n      return this.dependencies;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        href: this.href,\n        rootHref: this.rootHref,\n        dependencies: this.dependencies,\n        sourceMappingUrl: this.sourceMappingUrl,\n        code: this.magicString ? this.magicString.original : ''\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      var asset = new Asset(json.href, json.rootHref);\n      asset.dependencies = json.dependencies;\n      asset.sourceMappingUrl = json.sourceMappingUrl;\n      asset.setCode(json.code);\n      return asset;\n    }\n  }]);\n\n  return Asset;\n}();\n\n(function (Asset) {\n  var DependencyKind;\n\n  (function (DependencyKind) {\n    DependencyKind[\"Require\"] = \"require\";\n    DependencyKind[\"RequireResolve\"] = \"require.resolve\";\n    DependencyKind[\"InjectedGlobal\"] = \"injected_global\";\n  })(DependencyKind = Asset.DependencyKind || (Asset.DependencyKind = {}));\n})(Asset || (Asset = {}));\n\nfunction getParserForAsset(asset) {\n  if (asset.href.endsWith('.css')) {\n    return {\n      parse: function parse(_href, magicString) {\n        var cssCode = magicString.original;\n        var BACKSLASH = '\\\\'.charCodeAt(0);\n        var SINGLE_QUOTE = \"'\".charCodeAt(0);\n        var NL = '\\n'.charCodeAt(0);\n        var CR = '\\r'.charCodeAt(0);\n        var escaped = false;\n\n        for (var i = 0; i < cssCode.length; i++) {\n          var char = cssCode.charCodeAt(i);\n\n          if (char === BACKSLASH) {\n            escaped = !escaped;\n            continue;\n          }\n\n          if (!escaped) {\n            // Escape certain characters (if not already escaped)\n            switch (char) {\n              case CR:\n              case NL:\n                magicString.overwrite(i, i + 1, ' ');\n                break;\n\n              case SINGLE_QUOTE:\n                magicString.prependRight(i, '\\\\');\n                break;\n            }\n          }\n\n          escaped = false;\n        }\n\n        magicString.prepend(\"\\n          function reload(){\\n            var styleTag = document.createElement(\\\"style\\\");\\n            styleTag.type = \\\"text/css\\\";\\n            styleTag.innerHTML = '\");\n        magicString.append(\"';\\n            document.head.appendChild(styleTag);\\n\\n            return function() {    \\n              if (styleTag && styleTag.parentElement) {\\n                styleTag.parentElement.removeChild(styleTag);\\n              }\\n            };\\n          };\\n\\n          var remove = reload();\\n\\n          if (module.hot && module.hot.dispose) {\\n            module.hot.dispose(function() {\\n              remove();\\n            });\\n          }\\n        \");\n        return {\n          requireDependencies: [],\n          requireResolveDependencies: [],\n          unboundSymbols: new Map()\n        };\n      }\n    };\n  }\n\n  if (asset.href.endsWith('.json')) {\n    return {\n      parse: function parse(_href, magicString) {\n        magicString.prepend('module.exports = ');\n        return {\n          requireDependencies: [],\n          requireResolveDependencies: [],\n          unboundSymbols: new Map()\n        };\n      }\n    };\n  }\n\n  return {\n    parse: parseFile\n  };\n}\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this2;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this2.name = _this2.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this2), _this2.constructor);\n    } else {\n      _this2.stack = new Error(message).stack;\n    }\n\n    return _this2;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar InvariantViolation =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(InvariantViolation, _ExtendableError);\n\n  function InvariantViolation() {\n    _classCallCheck(this, InvariantViolation);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(InvariantViolation).apply(this, arguments));\n  }\n\n  return InvariantViolation;\n}(ExtendableError);\n\nvar NotSupportedError =\n/*#__PURE__*/\nfunction (_ExtendableError2) {\n  _inherits(NotSupportedError, _ExtendableError2);\n\n  function NotSupportedError() {\n    _classCallCheck(this, NotSupportedError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(NotSupportedError).apply(this, arguments));\n  }\n\n  return NotSupportedError;\n}(ExtendableError);\n\nvar ResolveError =\n/*#__PURE__*/\nfunction (_ExtendableError3) {\n  _inherits(ResolveError, _ExtendableError3);\n\n  function ResolveError(href, fromHref) {\n    var _this3;\n\n    _classCallCheck(this, ResolveError);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(ResolveError).call(this, \"Unable to resolve '\".concat(href, \"'\").concat(fromHref ? \" from '\".concat(fromHref, \"'\") : '')));\n    _this3.href = href;\n    _this3.fromHref = fromHref;\n    return _this3;\n  }\n\n  return ResolveError;\n}(ExtendableError);\n\nvar NODE_CORE_SHIMS = ['assert', 'buffer', 'constants', 'crypto', 'events', 'fs', 'http', 'https', 'net', 'os', 'path', 'process', 'querystring', 'stream', 'tls', 'url', 'util', 'vm', 'zlib'].reduce(function (shims, coreLibName) {\n  return Object.assign(shims, _defineProperty({}, coreLibName, \"@velcro/node-libs@\".concat(version, \"/lib/\").concat(coreLibName, \".js\")));\n}, {});\nNODE_CORE_SHIMS['string_decoder'] = 'string_decoder@1.2.0';\nNODE_CORE_SHIMS['punycode'] = 'punycode@2.1.1';\n\nfunction _resolveBareModuleReference2(_x, _x2, _x3) {\n  return _resolveBareModuleReference.apply(this, arguments);\n} //@ts-check\n\n/**\n *\n * @param {import('./types').ImmediateExecutionManifest} manifest\n * @param {import('./types').RuntimeOptions} [options]\n * @returns {import('./types').IRuntime}\n */\n\n\nfunction _resolveBareModuleReference() {\n  _resolveBareModuleReference = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee11(resolver, bareModuleReference, parentHref) {\n    var _ref22,\n        _ref22$invalidatedBy,\n        invalidatedBy,\n        token,\n        _parseBareModuleSpec,\n        name,\n        pathname,\n        spec,\n        resolvedSpec,\n        parentUrl,\n        parentPackageInfo,\n        consolidatedDependencies,\n        dependencySpec,\n        _resolvedSpec,\n        builtIn,\n        _parseBareModuleSpec2,\n        _name,\n        _pathname,\n        _spec,\n        _resolvedSpec2,\n        _args11 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n      while (1) {\n        switch (_context11.prev = _context11.next) {\n          case 0:\n            _ref22 = _args11.length > 3 && _args11[3] !== undefined ? _args11[3] : {}, _ref22$invalidatedBy = _ref22.invalidatedBy, invalidatedBy = _ref22$invalidatedBy === void 0 ? new Set() : _ref22$invalidatedBy, token = _ref22.token;\n\n            if (bareModuleReference) {\n              _context11.next = 3;\n              break;\n            }\n\n            throw new TypeError(\"Impossible to import an empty package name\".concat(parentHref ? \" from \".concat(parentHref) : ''));\n\n          case 3:\n            _parseBareModuleSpec = parseBareModuleSpec(bareModuleReference), name = _parseBareModuleSpec.name, pathname = _parseBareModuleSpec.pathname, spec = _parseBareModuleSpec.spec;\n\n            if (!spec) {\n              _context11.next = 13;\n              break;\n            }\n\n            _context11.prev = 5;\n            resolvedSpec = resolve(name, spec, parentHref);\n            return _context11.abrupt(\"return\", {\n              name: name,\n              pathname: pathname,\n              resolvedSpec: resolvedSpec,\n              spec: spec\n            });\n\n          case 10:\n            _context11.prev = 10;\n            _context11.t0 = _context11[\"catch\"](5);\n            throw _context11.t0;\n\n          case 13:\n            if (parentHref) {\n              _context11.next = 15;\n              break;\n            }\n\n            throw new ResolveError(spec, parentHref);\n\n          case 15:\n            _context11.prev = 15;\n            parentUrl = new URL(parentHref);\n            _context11.next = 22;\n            break;\n\n          case 19:\n            _context11.prev = 19;\n            _context11.t1 = _context11[\"catch\"](15);\n            throw new Error(\"Error loading bare module \".concat(spec, \" because the parent module \").concat(parentHref, \" could not be resolved to a URL\"));\n\n          case 22:\n            _context11.next = 24;\n            return resolver.readParentPackageJson(parentUrl, {\n              invalidatedBy: invalidatedBy,\n              token: token\n            });\n\n          case 24:\n            parentPackageInfo = _context11.sent;\n\n            if (!parentPackageInfo) {\n              _context11.next = 38;\n              break;\n            }\n\n            invalidatedBy.add(parentPackageInfo.url.href);\n            consolidatedDependencies = _objectSpread({}, parentPackageInfo.packageJson.peerDependencies || {}, {}, parentPackageInfo.packageJson.devDependencies || {}, {}, parentPackageInfo.packageJson.dependencies || {});\n            dependencySpec = consolidatedDependencies[name];\n\n            if (!dependencySpec) {\n              _context11.next = 38;\n              break;\n            }\n\n            _context11.prev = 30;\n            _resolvedSpec = resolve(name, dependencySpec, parentHref);\n            return _context11.abrupt(\"return\", {\n              name: name,\n              pathname: pathname,\n              resolvedSpec: _resolvedSpec,\n              spec: spec\n            });\n\n          case 35:\n            _context11.prev = 35;\n            _context11.t2 = _context11[\"catch\"](30);\n            throw _context11.t2;\n\n          case 38:\n            // That failed, let's try a NODE_SHIM\n            builtIn = NODE_CORE_SHIMS[bareModuleReference];\n\n            if (!builtIn) {\n              _context11.next = 51;\n              break;\n            }\n\n            _parseBareModuleSpec2 = parseBareModuleSpec(builtIn), _name = _parseBareModuleSpec2.name, _pathname = _parseBareModuleSpec2.pathname, _spec = _parseBareModuleSpec2.spec;\n\n            if (_spec) {\n              _context11.next = 43;\n              break;\n            }\n\n            throw new InvariantViolation(\"Found a node core shim '\".concat(builtIn, \"' for '\").concat(bareModuleReference, \"' that didn't include a version specifier\"));\n\n          case 43:\n            _context11.prev = 43;\n            _resolvedSpec2 = resolve(_name, _spec, parentHref);\n            return _context11.abrupt(\"return\", {\n              name: _name,\n              pathname: _pathname,\n              resolvedSpec: _resolvedSpec2,\n              spec: _spec\n            });\n\n          case 48:\n            _context11.prev = 48;\n            _context11.t3 = _context11[\"catch\"](43);\n            throw _context11.t3;\n\n          case 51:\n          case \"end\":\n            return _context11.stop();\n        }\n      }\n    }, _callee11, null, [[5, 10], [15, 19], [30, 35], [43, 48]]);\n  }));\n  return _resolveBareModuleReference.apply(this, arguments);\n}\n\nfunction createRuntime(manifest, options) {\n  /** @type {Record<string, string | undefined>} */\n  var aliases = Object.create(null);\n  /** @type {Record<string, Record<string, string | undefined> | undefined> } */\n\n  var mappings = Object.create(null);\n  /** @type {Record<string, Module | undefined>} */\n\n  var modules = Object.create(null);\n  /** @type {Record<string, import('./types').ModuleFactory | undefined>} */\n\n  var registry = Object.create(null);\n  var logLevel = {\n    never: 0,\n    debug: 1\n  }[options && options.loggerLevel || 'never'];\n  /** @type {import('./types').RuntimeLogger} */\n\n  var logger = {\n    debug: function debug() {\n      var _console;\n\n      if (logLevel >= 1) (_console = console).debug.apply(_console, arguments);\n    }\n  };\n  /**\n   * @class\n   * @implements {import('./types').IRuntime}\n   * @property {Module} root\n   */\n\n  function Runtime() {\n    /**\n     * @readonly\n     */\n    this.root = new Module('velcro://root', this);\n  }\n  /**\n   * @param {string} name\n   * @param {string} id\n   */\n\n\n  Runtime.prototype.alias = function (name, id) {\n    logger.debug(\"runtime.alias(%s, %s)\", name, id);\n    aliases[name] = id;\n  };\n  /**\n   * @param {string} fromId\n   * @param {string} spec\n   * @param {string} toId\n   */\n\n\n  Runtime.prototype.dependency = function (fromId, spec, toId) {\n    logger.debug(\"runtime.dependency(%s, %s, %s)\", fromId, spec, toId);\n    var mappingsForId = mappings[fromId];\n\n    if (!mappingsForId) {\n      mappingsForId = {};\n      mappings[fromId] = mappingsForId;\n    }\n\n    mappingsForId[spec] = toId;\n  };\n  /**\n   * @param {string} id\n   */\n\n\n  Runtime.prototype.get = function (id) {\n    id = aliases[id] || id;\n    return modules[id];\n  };\n  /**\n   * @param {string} fromId\n   * @param {string} spec\n   * @returns {string}\n   */\n\n\n  Runtime.prototype.getId = function (fromId, spec) {\n    var alias = aliases[spec];\n\n    if (alias) {\n      return alias;\n    }\n\n    var mappingsForId = mappings[fromId];\n    return mappingsForId && mappingsForId[spec] || spec;\n  };\n  /**\n   * @param {import('./types').ImmediateExecutionManifest} manifest\n   * @param {boolean} [executeEntrypoints]\n   */\n\n\n  Runtime.prototype.init = function (manifest, executeEntrypoints) {\n    for (var href in manifest.modules) {\n      var module = manifest.modules[href];\n\n      for (var alias in module.dependencies) {\n        this.dependency(href, alias, module.dependencies[alias]);\n      }\n\n      this.register(href, module.factory);\n    }\n\n    for (var _alias in manifest.aliases) {\n      this.alias(_alias, manifest.aliases[_alias]);\n    }\n\n    for (var entrypoint in manifest.entrypoints) {\n      this.alias(entrypoint, manifest.entrypoints[entrypoint]);\n\n      if (executeEntrypoints) {\n        this.require(entrypoint);\n      }\n    }\n  };\n  /**\n   * @param {string} id\n   * @param {import('./types').ModuleFactory} factory\n   */\n\n\n  Runtime.prototype.register = function (id, factory) {\n    logger.debug(\"runtime.register(%s, %s)\", id, factory.name);\n    registry[id] = factory;\n  };\n  /**\n   * @param {string} id\n   * @returns {Module | undefined}\n   */\n\n\n  Runtime.prototype.remove = function (id) {\n    logger.debug(\"runtime.remove(%s)\", id);\n    var module = this.get(id);\n\n    if (!module) {\n      return;\n    }\n\n    module.dependents.forEach(function (dependent) {\n      dependent.dependencies.delete(module);\n    });\n    module.dependencies.forEach(function (dependency) {\n      dependency.dependents.delete(module);\n    });\n    delete modules[module.id];\n    return module;\n  };\n  /**\n   * @param {string} id\n   */\n\n\n  Runtime.prototype.require = function (id) {\n    return this.root.require(aliases[id] || id);\n  };\n  /**\n   * @param {string} id\n   * @returns {Module | undefined}\n   */\n\n\n  Runtime.prototype.unregister = function (id) {\n    logger.debug(\"runtime.unregister(%s)\", id);\n    var module = this.get(id);\n\n    if (!module) {\n      return;\n    }\n\n    delete mappings[module.id];\n    delete registry[module.id];\n    return module;\n  };\n  /**\n   * @class\n   * @param {Module} module\n   */\n\n\n  function HotModule(module) {\n    /** @private */\n    this.module = module;\n  }\n  /**\n   * @param {() => void} cb\n   */\n\n\n  HotModule.prototype.accept = function (cb) {\n    this.module.acceptCallbacks.push({\n      cb: cb\n    });\n  };\n  /**\n   * @param {() => void} cb\n   */\n\n\n  HotModule.prototype.dispose = function (cb) {\n    this.module.disposeCallbacks.push({\n      cb: cb\n    });\n  };\n  /**\n   * @class\n   * @param {string} id\n   * @param {Runtime} runtime\n   */\n\n\n  function Module(id, runtime) {\n    /** @type {Set<Module>} */\n    this.dependencies = new Set();\n    /** @type {Set<Module>} */\n\n    this.dependents = new Set();\n    this.id = id;\n    /** @type {import('./types').AcceptCallback[]} */\n\n    this.acceptCallbacks = [];\n    /** @type {import('./types').DisposeCallback[]} */\n\n    this.disposeCallbacks = [];\n    /** @readonly */\n\n    this.module = Object.seal({\n      exports: {},\n      id: id,\n      hot: new HotModule(this)\n    });\n    /** @readonly */\n\n    this.runtime = runtime;\n    Object.defineProperty(this, Symbol.toStringTag, {\n      configurable: false,\n      enumerable: false,\n      get: function get() {\n        return 'Module';\n      }\n    });\n  }\n  /**\n   * @param {string} id\n   */\n\n\n  Module.prototype.require = function (id) {\n    id = this.runtime.getId(this.id, id);\n    /** @type {Module | undefined} */\n\n    var module = modules[id];\n\n    if (!module) {\n      var factory = registry[id];\n\n      if (!factory) {\n        throw new Error(\"Factory missing for \".concat(id));\n      }\n\n      module = new Module(id, this.runtime);\n      modules[id] = module;\n      var dirname = id;\n      var filename = id;\n      factory.call(module.module.exports, module.module, module.module.exports, module.require.bind(module), dirname, filename);\n      logger.debug(\"require::factory(%s)\", id);\n    } // In a hot reload scenario there may be two generations\n    // of the same module. Don't record these dependencies.\n\n\n    if (module.id !== this.id) {\n      module.dependents.add(this);\n      this.dependencies.add(module);\n    }\n\n    return module.module.exports;\n  }; //@ts-ignore\n\n\n  var runtime = options && options.runtime && window[options.runtime] || new Runtime();\n  runtime.init(manifest, options && options.executeEntrypoints);\n  return runtime;\n} //@ts-check\n\n/**\n *\n * @param {import('./types').ImmediateExecutionManifest} manifest\n * @param {import('./types').RuntimeOptions} [options]\n * @returns {import('./types').IRuntime}\n */\n\n\nfunction createIncrementalPrelude(manifest, options) {\n  /** @type {import('./types').IRuntime} */\n  //@ts-ignore\n  var runtime = window[options.runtime];\n  runtime.init(manifest, options && options.executeEntrypoints);\n  return runtime;\n}\n\nvar Bundle =\n/*#__PURE__*/\nfunction () {\n  function Bundle(assets, entrypointsToAssets, dependenciesToAssets) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Bundle);\n\n    this.assets = assets;\n    this.entrypointsToAssets = entrypointsToAssets;\n    this.dependenciesToAssets = dependenciesToAssets;\n    this.options = options;\n    this.assetsByHref = new Map();\n    var _iteratorNormalCompletion8 = true;\n    var _didIteratorError8 = false;\n    var _iteratorError8 = undefined;\n\n    try {\n      for (var _iterator8 = assets[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n        var asset = _step8.value;\n        this.assetsByHref.set(asset.href, asset);\n      }\n    } catch (err) {\n      _didIteratorError8 = true;\n      _iteratorError8 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion8 && _iterator8.return != null) {\n          _iterator8.return();\n        }\n      } finally {\n        if (_didIteratorError8) {\n          throw _iteratorError8;\n        }\n      }\n    }\n  }\n\n  _createClass(Bundle, [{\n    key: \"buildForImmediateExecution\",\n    value: function buildForImmediateExecution() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var bundle = new Bundle$1({\n        separator: '\\n\\t\\t,\\n'\n      });\n      var _iteratorNormalCompletion9 = true;\n      var _didIteratorError9 = false;\n      var _iteratorError9 = undefined;\n\n      try {\n        for (var _iterator9 = this.assets[Symbol.iterator](), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n          var asset = _step9.value;\n          bundle.addSource(buildAssetForImmediateExecution(asset));\n        }\n      } catch (err) {\n        _didIteratorError9 = true;\n        _iteratorError9 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion9 && _iterator9.return != null) {\n            _iterator9.return();\n          }\n        } finally {\n          if (_didIteratorError9) {\n            throw _iteratorError9;\n          }\n        }\n      }\n\n      var aliasMap = Array.from(this.dependenciesToAssets).reduce(function (acc, _ref8) {\n        var _ref9 = _slicedToArray(_ref8, 2),\n            name = _ref9[0],\n            asset = _ref9[1];\n\n        acc[name] = asset.href;\n        return acc;\n      }, {});\n      var entrypointMap = Array.from(this.entrypointsToAssets).reduce(function (acc, _ref10) {\n        var _ref11 = _slicedToArray(_ref10, 2),\n            name = _ref11[0],\n            asset = _ref11[1];\n\n        acc[name] = asset.href;\n        return acc;\n      }, {});\n      var runtimeOptions = {\n        executeEntrypoints: options.executeEntrypoints,\n        loggerLevel: options.loggerLevel,\n        runtime: options.runtime\n      };\n      var prelude = this.options.incremental && options.runtime ? createIncrementalPrelude.toString() : createRuntime.toString();\n      bundle.prepend(\"(\".concat(prelude, \")({\\n\\taliases:\").concat(JSON.stringify(aliasMap), \",\\n\\tentrypoints:\").concat(JSON.stringify(entrypointMap), \",\\n\\tmodules:{\\n\"));\n      bundle.append(\"\\n\\t}\\n}, \".concat(JSON.stringify(runtimeOptions), \");\"));\n      var code = bundle.toString();\n      var sourceMap = options.sourceMap ? this.generateSourceMap(bundle, '') : undefined;\n      return {\n        code: code,\n        sourceMap: sourceMap\n      };\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      var _this$buildForImmedia = this.buildForImmediateExecution(options),\n          code = _this$buildForImmedia.code,\n          sourceMap = _this$buildForImmedia.sourceMap;\n\n      return code + (sourceMap ? \"\\n//# sourceMappingURL=\".concat(sourceMap.toDataUri()) : '');\n    }\n  }, {\n    key: \"generateSourceMap\",\n    value: function generateSourceMap(bundle, href) {\n      var _this4 = this;\n\n      var inputMap = bundle.generateMap({\n        includeContent: true,\n        hires: false,\n        source: href\n      }); // In case a source map seems to be self-referential, avoid crashing\n\n      var seen = new Set();\n      return new SourceMap(remapping(inputMap.toString(), function (uri) {\n        var asset = _this4.assetsByHref.get(uri);\n\n        if (asset && asset.sourceMappingUrl) {\n          if (seen.has(asset)) {\n            return null;\n          }\n\n          seen.add(asset);\n          var match = asset.sourceMappingUrl.match(/^data:application\\/json;(?:charset=([^;]+);)?base64,(.*)$/);\n\n          if (match) {\n            if (match[1] && match[1] !== 'utf-8') {\n              return null;\n            }\n\n            try {\n              var decoded = JSON.parse(Base64.decode(match[2]));\n              return decoded;\n            } catch (err) {\n              return null;\n            }\n          }\n        }\n\n        return null;\n      }, false));\n    }\n  }]);\n\n  return Bundle;\n}();\n\nvar SourceMap =\n/*#__PURE__*/\nfunction () {\n  function SourceMap(input) {\n    _classCallCheck(this, SourceMap);\n\n    this.file = input.file;\n    this.mappings = input.mappings;\n    this.sourceRoot = input.sourceRoot;\n    this.names = input.names;\n    this.sources = input.sources;\n    this.sourcesContent = input.sourcesContent;\n    this.version = input.version;\n  }\n\n  _createClass(SourceMap, [{\n    key: \"toString\",\n    value: function toString() {\n      return JSON.stringify(this);\n    }\n  }, {\n    key: \"toDataUri\",\n    value: function toDataUri() {\n      return \"data:application/json;charset=utf-8;base64,\".concat(Base64.encode(this.toString()));\n    }\n  }]);\n\n  return SourceMap;\n}();\n\nfunction buildAssetAndCollectDependencies(asset) {\n  var indent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '\\t';\n\n  if (!asset.magicString) {\n    throw new InvariantViolation(\"Invariant violation: asset is not loaded '\".concat(asset.href, \"'\"));\n  }\n\n  var dependencies = {};\n  var magicString = asset.magicString.clone();\n  magicString.trim();\n  magicString.indent(indent);\n\n  if (!asset.dependencies) {\n    throw new InvariantViolation(\"Asset '\".concat(asset.href, \"' scheduled for build is missing its dependencies array\"));\n  } // We'll replace each dependency string with the resolved stable href. The stable href doesn't require any\n  // information about where it is being resolved from, so it is useful as a long-term pointer whose target\n  // can change over time\n\n\n  var _iteratorNormalCompletion10 = true;\n  var _didIteratorError10 = false;\n  var _iteratorError10 = undefined;\n\n  try {\n    for (var _iterator10 = asset.dependencies[Symbol.iterator](), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n      var dependency = _step10.value;\n\n      if (!dependency.resolveDetails) {\n        throw new InvariantViolation(\"Asset '\".concat(asset.href, \"' has an unresolved dependency of type '\").concat(dependency.type, \"' with spec '\").concat(dependency.value, \"'\"));\n      }\n\n      switch (dependency.type) {\n        case Asset.DependencyKind.Require:\n          {\n            dependencies[dependency.value] = dependency.resolveDetails.resolvedHref;\n            break;\n          }\n\n        case Asset.DependencyKind.RequireResolve:\n          {\n            dependencies[dependency.value] = dependency.resolveDetails.resolvedHref;\n            break;\n          }\n\n        case Asset.DependencyKind.InjectedGlobal:\n          {\n            magicString.prepend(\"\\n\".concat(indent, \"const \").concat(dependency.symbolName, \" = require(\").concat(JSON.stringify(dependency.symbolName), \")\").concat(dependency.exportName ? \".\".concat(dependency.exportName) : '', \";\\n\"));\n            dependencies[dependency.symbolName] = dependency.resolveDetails.resolvedHref;\n            break;\n          }\n\n        default:\n          throw new Error(\"Invariant violation: Encountered unexpected dependency kind '\".concat(dependency.type, \"'\"));\n      }\n    }\n  } catch (err) {\n    _didIteratorError10 = true;\n    _iteratorError10 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion10 && _iterator10.return != null) {\n        _iterator10.return();\n      }\n    } finally {\n      if (_didIteratorError10) {\n        throw _iteratorError10;\n      }\n    }\n  }\n\n  return {\n    dependencies: dependencies,\n    magicString: magicString\n  };\n}\n\nfunction buildAssetForImmediateExecution(asset) {\n  var _buildAssetAndCollect = buildAssetAndCollectDependencies(asset, '\\t\\t\\t\\t'),\n      dependencies = _buildAssetAndCollect.dependencies,\n      magicString = _buildAssetAndCollect.magicString;\n\n  magicString.prepend(\"\\t\\t\".concat(JSON.stringify(asset.href), \": {\\n\\t\\t\\tdependencies: \").concat(JSON.stringify(dependencies), \",\\n\\t\\t\\tfactory: function(module, exports, require, __dirname, __filename){\\n\"));\n  magicString.append('\\n\\t\\t}}');\n  return magicString;\n}\n\nvar EMPTY_MODULE_URL = new URL('velcro://@empty');\nvar EMPTY_MODULE_CODE = 'module.exports = function(){};';\nvar noopLogger = {\n  info: function info() {}\n};\n\nvar Bundler =\n/*#__PURE__*/\nfunction () {\n  function Bundler(options) {\n    _classCallCheck(this, Bundler);\n\n    this.assetsByHref = new Map();\n    this.resolutionCache = new Map();\n    this.resolutionInvalidations = new MapSet();\n    this.onAssetAddedEmitter = new Emitter();\n    this.onAssetRemovedEmitter = new Emitter();\n    this.logger = options.logger || noopLogger;\n    this.resolveBareModule = options.resolveBareModule;\n    this.resolver = options.resolver;\n  }\n\n  _createClass(Bundler, [{\n    key: \"dispose\",\n    value: function dispose() {\n      this.onAssetAddedEmitter.dispose();\n      this.onAssetRemovedEmitter.dispose();\n      this.assetsByHref.clear();\n    }\n  }, {\n    key: \"getOrCreateAsset\",\n    value: function getOrCreateAsset(_ref12) {\n      var href = _ref12.resolvedHref,\n          rootHref = _ref12.rootHref;\n      var asset = this.assetsByHref.get(href);\n\n      if (!asset) {\n        asset = new Asset(href, rootHref);\n        this.assetsByHref.set(href, asset);\n        this.onAssetAddedEmitter.fire(asset);\n      }\n\n      return asset;\n    }\n  }, {\n    key: \"generateBundle\",\n    value: function () {\n      var _generateBundle = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(entrypoints) {\n        var _this5 = this;\n\n        var options,\n            tokenSource,\n            token,\n            incremental,\n            pendingOperations,\n            assets,\n            incrementalAssets,\n            dfd,\n            dependenciesToAssets,\n            entrypointsToAssets,\n            enqueue,\n            resolveHref,\n            resolveAsset,\n            resolveDependency,\n            _iteratorNormalCompletion13,\n            _didIteratorError13,\n            _iteratorError13,\n            _iterator13,\n            _step13,\n            invalidation,\n            _iteratorNormalCompletion14,\n            _didIteratorError14,\n            _iteratorError14,\n            _iterator14,\n            _step14,\n            resolutionCacheKey,\n            asset,\n            _iteratorNormalCompletion15,\n            _didIteratorError15,\n            _iteratorError15,\n            _loop,\n            _iterator15,\n            _step15,\n            _args6 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                options = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : {};\n\n                if (Array.isArray(entrypoints)) {\n                  _context6.next = 3;\n                  break;\n                }\n\n                throw new Error('Generating a bundle requires passing in an array of entrypoints');\n\n              case 3:\n                tokenSource = new CancellationTokenSource();\n                token = tokenSource.token;\n                incremental = !!options.incremental;\n\n                if (options.token) {\n                  if (options.token.isCancellationRequested) {\n                    tokenSource.cancel();\n                    tokenSource.dispose();\n                  }\n\n                  options.token.onCancellationRequested(function () {\n                    tokenSource.cancel();\n                    tokenSource.dispose();\n                  });\n                }\n\n                pendingOperations = 0;\n                assets = new Set();\n                incrementalAssets = new Set();\n                dfd = new Deferred(token);\n                dependenciesToAssets = new Map();\n                entrypointsToAssets = new Map();\n\n                enqueue =\n                /*#__PURE__*/\n                function () {\n                  var _ref13 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee(op) {\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _context.prev = 0;\n                            pendingOperations++;\n\n                            if (options.onEnqueueAsset) {\n                              options.onEnqueueAsset();\n                            }\n\n                            _context.next = 5;\n                            return op();\n\n                          case 5:\n                            if (options.onCompleteAsset) {\n                              options.onCompleteAsset();\n                            }\n\n                            pendingOperations--;\n\n                            if (!(pendingOperations < 0)) {\n                              _context.next = 9;\n                              break;\n                            }\n\n                            throw new InvariantViolation('Pending operations fell below zero');\n\n                          case 9:\n                            if (pendingOperations === 0) {\n                              // Let's make sure this happens after the current microtask.\n                              setTimeout(function () {\n                                return dfd.resolve();\n                              }, 0);\n                            }\n\n                            _context.next = 15;\n                            break;\n\n                          case 12:\n                            _context.prev = 12;\n                            _context.t0 = _context[\"catch\"](0);\n\n                            // Let's make sure this happens 'later'.\n                            if (!dfd.isSettled) {\n                              Promise.resolve().then(function () {\n                                return dfd.reject(_context.t0);\n                              }).catch(function (_) {\n                                return undefined;\n                              });\n                            }\n\n                          case 15:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee, null, [[0, 12]]);\n                  }));\n\n                  return function enqueue(_x5) {\n                    return _ref13.apply(this, arguments);\n                  };\n                }();\n\n                resolveHref =\n                /*#__PURE__*/\n                function () {\n                  var _ref14 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee2(spec, fromHref) {\n                    var resolutionCacheKey, resolveDetails, _iteratorNormalCompletion11, _didIteratorError11, _iteratorError11, _iterator11, _step11, invalidatedBy;\n\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            resolutionCacheKey = JSON.stringify([spec, fromHref]);\n                            resolveDetails = _this5.resolutionCache.get(resolutionCacheKey);\n\n                            if (resolveDetails) {\n                              _context2.next = 27;\n                              break;\n                            }\n\n                            _this5.logger.info({\n                              spec: spec,\n                              fromHref: fromHref\n                            }, 'resolveHref cache miss'); // console.debug('[MISS] resolveHref(%s, %s)', spec, fromHref);\n\n\n                            _context2.next = 6;\n                            return _this5.resolveWithDetails(spec, fromHref, {\n                              token: token\n                            });\n\n                          case 6:\n                            resolveDetails = _context2.sent;\n\n                            _this5.resolutionCache.set(resolutionCacheKey, resolveDetails);\n\n                            _iteratorNormalCompletion11 = true;\n                            _didIteratorError11 = false;\n                            _iteratorError11 = undefined;\n                            _context2.prev = 11;\n\n                            for (_iterator11 = resolveDetails.invalidatedBy[Symbol.iterator](); !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n                              invalidatedBy = _step11.value;\n\n                              if (invalidatedBy !== resolveDetails.resolvedHref) {\n                                _this5.resolutionInvalidations.add(invalidatedBy, resolutionCacheKey);\n                              }\n                            }\n\n                            _context2.next = 19;\n                            break;\n\n                          case 15:\n                            _context2.prev = 15;\n                            _context2.t0 = _context2[\"catch\"](11);\n                            _didIteratorError11 = true;\n                            _iteratorError11 = _context2.t0;\n\n                          case 19:\n                            _context2.prev = 19;\n                            _context2.prev = 20;\n\n                            if (!_iteratorNormalCompletion11 && _iterator11.return != null) {\n                              _iterator11.return();\n                            }\n\n                          case 22:\n                            _context2.prev = 22;\n\n                            if (!_didIteratorError11) {\n                              _context2.next = 25;\n                              break;\n                            }\n\n                            throw _iteratorError11;\n\n                          case 25:\n                            return _context2.finish(22);\n\n                          case 26:\n                            return _context2.finish(19);\n\n                          case 27:\n                            return _context2.abrupt(\"return\", resolveDetails);\n\n                          case 28:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2, null, [[11, 15, 19, 27], [20,, 22, 26]]);\n                  }));\n\n                  return function resolveHref(_x6, _x7) {\n                    return _ref14.apply(this, arguments);\n                  };\n                }();\n\n                resolveAsset =\n                /*#__PURE__*/\n                function () {\n                  var _ref15 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee3(resolveDetails) {\n                    var asset, code, _iteratorNormalCompletion12, _didIteratorError12, _iteratorError12, _iterator12, _step12, dependency;\n\n                    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                      while (1) {\n                        switch (_context3.prev = _context3.next) {\n                          case 0:\n                            asset = _this5.getOrCreateAsset(resolveDetails); // Already enqueued in this bundle, no need to re-enqueue\n\n                            if (assets.has(asset)) {\n                              _context3.next = 29;\n                              break;\n                            }\n\n                            assets.add(asset);\n\n                            if (!(!asset.magicString || !asset.dependencies)) {\n                              _context3.next = 10;\n                              break;\n                            }\n\n                            _this5.logger.info({\n                              href: asset.href\n                            }, 'resolveAsset readCode'); // console.debug('[MISS] resolveAsset(%s)', asset.href);\n\n\n                            _context3.next = 7;\n                            return _this5.readCode(asset, {\n                              token: token\n                            });\n\n                          case 7:\n                            code = _context3.sent;\n                            asset.setCode(code); // We only add assets that needed to be (re)created to an incremental build\n\n                            incrementalAssets.add(asset);\n\n                          case 10:\n                            _iteratorNormalCompletion12 = true;\n                            _didIteratorError12 = false;\n                            _iteratorError12 = undefined;\n                            _context3.prev = 13;\n\n                            for (_iterator12 = asset.dependencies[Symbol.iterator](); !(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done); _iteratorNormalCompletion12 = true) {\n                              dependency = _step12.value;\n                              resolveDependency(asset, dependency);\n                            }\n\n                            _context3.next = 21;\n                            break;\n\n                          case 17:\n                            _context3.prev = 17;\n                            _context3.t0 = _context3[\"catch\"](13);\n                            _didIteratorError12 = true;\n                            _iteratorError12 = _context3.t0;\n\n                          case 21:\n                            _context3.prev = 21;\n                            _context3.prev = 22;\n\n                            if (!_iteratorNormalCompletion12 && _iterator12.return != null) {\n                              _iterator12.return();\n                            }\n\n                          case 24:\n                            _context3.prev = 24;\n\n                            if (!_didIteratorError12) {\n                              _context3.next = 27;\n                              break;\n                            }\n\n                            throw _iteratorError12;\n\n                          case 27:\n                            return _context3.finish(24);\n\n                          case 28:\n                            return _context3.finish(21);\n\n                          case 29:\n                            return _context3.abrupt(\"return\", asset);\n\n                          case 30:\n                          case \"end\":\n                            return _context3.stop();\n                        }\n                      }\n                    }, _callee3, null, [[13, 17, 21, 29], [22,, 24, 28]]);\n                  }));\n\n                  return function resolveAsset(_x8) {\n                    return _ref15.apply(this, arguments);\n                  };\n                }();\n\n                resolveDependency = function resolveDependency(asset, dependency) {\n                  enqueue(\n                  /*#__PURE__*/\n                  _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee4() {\n                    var resolutionCacheKey, resolveDetails;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            resolutionCacheKey = JSON.stringify([dependency.value, asset.href]);\n                            resolveDetails = _this5.resolutionCache.get(resolutionCacheKey);\n\n                            if (resolveDetails) {\n                              _context4.next = 10;\n                              break;\n                            }\n\n                            _this5.logger.info({\n                              href: asset.href,\n                              dependency: dependency.value\n                            }, 'resolveDependency cache miss'); // console.debug('[MISS] resolveDependency(%s, %s)', asset.href, dependency.value);\n\n\n                            _context4.next = 6;\n                            return resolveHref(dependency.value, asset.href);\n\n                          case 6:\n                            resolveDetails = _context4.sent;\n                            dependency.resolveDetails = resolveDetails;\n                            _context4.next = 10;\n                            break;\n\n                          case 10:\n                            return _context4.abrupt(\"return\", resolveAsset(resolveDetails));\n\n                          case 11:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  })));\n                };\n\n                if (!options.invalidations) {\n                  _context6.next = 64;\n                  break;\n                }\n\n                _iteratorNormalCompletion13 = true;\n                _didIteratorError13 = false;\n                _iteratorError13 = undefined;\n                _context6.prev = 21;\n                _iterator13 = options.invalidations[Symbol.iterator]();\n\n              case 23:\n                if (_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done) {\n                  _context6.next = 50;\n                  break;\n                }\n\n                invalidation = _step13.value;\n                _iteratorNormalCompletion14 = true;\n                _didIteratorError14 = false;\n                _iteratorError14 = undefined;\n                _context6.prev = 28;\n\n                for (_iterator14 = this.resolutionInvalidations.getValues(invalidation)[Symbol.iterator](); !(_iteratorNormalCompletion14 = (_step14 = _iterator14.next()).done); _iteratorNormalCompletion14 = true) {\n                  resolutionCacheKey = _step14.value;\n\n                  if (this.resolutionCache.delete(resolutionCacheKey)) {\n                    this.logger.info({\n                      resolutionCacheKey: resolutionCacheKey\n                    }, 'invalidated resolution cache entry'); // console.debug('[INVALID] invalidated resolution %s by %s', resolutionCacheKey, invalidation);\n                  }\n                }\n\n                _context6.next = 36;\n                break;\n\n              case 32:\n                _context6.prev = 32;\n                _context6.t0 = _context6[\"catch\"](28);\n                _didIteratorError14 = true;\n                _iteratorError14 = _context6.t0;\n\n              case 36:\n                _context6.prev = 36;\n                _context6.prev = 37;\n\n                if (!_iteratorNormalCompletion14 && _iterator14.return != null) {\n                  _iterator14.return();\n                }\n\n              case 39:\n                _context6.prev = 39;\n\n                if (!_didIteratorError14) {\n                  _context6.next = 42;\n                  break;\n                }\n\n                throw _iteratorError14;\n\n              case 42:\n                return _context6.finish(39);\n\n              case 43:\n                return _context6.finish(36);\n\n              case 44:\n                if (this.resolutionInvalidations.deleteAll(invalidation)) {\n                  this.logger.info({\n                    invalidation: invalidation\n                  }, 'invalidated resolution invalidations');\n                }\n\n                asset = this.assetsByHref.get(invalidation);\n\n                if (asset) {\n                  asset.magicString = undefined;\n                  this.logger.info({\n                    href: invalidation\n                  }, 'invalidated asset'); // console.debug('[INVALID] invalidated asset %s', invalidation);\n                }\n\n              case 47:\n                _iteratorNormalCompletion13 = true;\n                _context6.next = 23;\n                break;\n\n              case 50:\n                _context6.next = 56;\n                break;\n\n              case 52:\n                _context6.prev = 52;\n                _context6.t1 = _context6[\"catch\"](21);\n                _didIteratorError13 = true;\n                _iteratorError13 = _context6.t1;\n\n              case 56:\n                _context6.prev = 56;\n                _context6.prev = 57;\n\n                if (!_iteratorNormalCompletion13 && _iterator13.return != null) {\n                  _iterator13.return();\n                }\n\n              case 59:\n                _context6.prev = 59;\n\n                if (!_didIteratorError13) {\n                  _context6.next = 62;\n                  break;\n                }\n\n                throw _iteratorError13;\n\n              case 62:\n                return _context6.finish(59);\n\n              case 63:\n                return _context6.finish(56);\n\n              case 64:\n                _iteratorNormalCompletion15 = true;\n                _didIteratorError15 = false;\n                _iteratorError15 = undefined;\n                _context6.prev = 67;\n\n                _loop = function _loop() {\n                  var entrypoint = _step15.value;\n                  enqueue(\n                  /*#__PURE__*/\n                  _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee5() {\n                    var resolveDetails, asset, code, dependencies, _iteratorNormalCompletion16, _didIteratorError16, _iteratorError16, _iterator16, _step16, dependency;\n\n                    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            _context5.next = 2;\n                            return resolveHref(entrypoint);\n\n                          case 2:\n                            resolveDetails = _context5.sent;\n                            _context5.next = 5;\n                            return resolveAsset(resolveDetails);\n\n                          case 5:\n                            asset = _context5.sent;\n                            entrypointsToAssets.set(entrypoint, asset);\n\n                            if (!(!asset.magicString || !asset.dependencies)) {\n                              _context5.next = 31;\n                              break;\n                            }\n\n                            _context5.next = 10;\n                            return _this5.readCode(asset, {\n                              token: token\n                            });\n\n                          case 10:\n                            code = _context5.sent;\n                            dependencies = asset.setCode(code);\n                            _iteratorNormalCompletion16 = true;\n                            _didIteratorError16 = false;\n                            _iteratorError16 = undefined;\n                            _context5.prev = 15;\n\n                            for (_iterator16 = dependencies[Symbol.iterator](); !(_iteratorNormalCompletion16 = (_step16 = _iterator16.next()).done); _iteratorNormalCompletion16 = true) {\n                              dependency = _step16.value;\n                              resolveDependency(asset, dependency);\n                            }\n\n                            _context5.next = 23;\n                            break;\n\n                          case 19:\n                            _context5.prev = 19;\n                            _context5.t0 = _context5[\"catch\"](15);\n                            _didIteratorError16 = true;\n                            _iteratorError16 = _context5.t0;\n\n                          case 23:\n                            _context5.prev = 23;\n                            _context5.prev = 24;\n\n                            if (!_iteratorNormalCompletion16 && _iterator16.return != null) {\n                              _iterator16.return();\n                            }\n\n                          case 26:\n                            _context5.prev = 26;\n\n                            if (!_didIteratorError16) {\n                              _context5.next = 29;\n                              break;\n                            }\n\n                            throw _iteratorError16;\n\n                          case 29:\n                            return _context5.finish(26);\n\n                          case 30:\n                            return _context5.finish(23);\n\n                          case 31:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5, null, [[15, 19, 23, 31], [24,, 26, 30]]);\n                  })));\n                };\n\n                for (_iterator15 = entrypoints[Symbol.iterator](); !(_iteratorNormalCompletion15 = (_step15 = _iterator15.next()).done); _iteratorNormalCompletion15 = true) {\n                  _loop();\n                }\n\n                _context6.next = 76;\n                break;\n\n              case 72:\n                _context6.prev = 72;\n                _context6.t2 = _context6[\"catch\"](67);\n                _didIteratorError15 = true;\n                _iteratorError15 = _context6.t2;\n\n              case 76:\n                _context6.prev = 76;\n                _context6.prev = 77;\n\n                if (!_iteratorNormalCompletion15 && _iterator15.return != null) {\n                  _iterator15.return();\n                }\n\n              case 79:\n                _context6.prev = 79;\n\n                if (!_didIteratorError15) {\n                  _context6.next = 82;\n                  break;\n                }\n\n                throw _iteratorError15;\n\n              case 82:\n                return _context6.finish(79);\n\n              case 83:\n                return _context6.finish(76);\n\n              case 84:\n                _context6.next = 86;\n                return dfd.promise;\n\n              case 86:\n                return _context6.abrupt(\"return\", new Bundle(incremental ? incrementalAssets : assets, entrypointsToAssets, dependenciesToAssets, {\n                  incremental: incremental\n                }));\n\n              case 87:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[21, 52, 56, 64], [28, 32, 36, 44], [37,, 39, 43], [57,, 59, 63], [67, 72, 76, 84], [77,, 79, 83]]);\n      }));\n\n      function generateBundle(_x4) {\n        return _generateBundle.apply(this, arguments);\n      }\n\n      return generateBundle;\n    }()\n  }, {\n    key: \"readCode\",\n    value: function () {\n      var _readCode = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee7(asset, _ref18) {\n        var token, buf, code;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                token = _ref18.token;\n\n                if (!(asset.href === EMPTY_MODULE_URL.href)) {\n                  _context7.next = 3;\n                  break;\n                }\n\n                return _context7.abrupt(\"return\", EMPTY_MODULE_CODE);\n\n              case 3:\n                _context7.next = 5;\n                return this.resolver.host.readFileContent(this.resolver, new URL(asset.href), {\n                  token: token\n                });\n\n              case 5:\n                buf = _context7.sent;\n                code = this.resolver.decoder.decode(buf);\n                return _context7.abrupt(\"return\", code);\n\n              case 8:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function readCode(_x9, _x10) {\n        return _readCode.apply(this, arguments);\n      }\n\n      return readCode;\n    }()\n  }, {\n    key: \"resolveBareModuleReference\",\n    value: function () {\n      var _resolveBareModuleReference3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee8(href, fromHref) {\n        var _ref19,\n            _ref19$invalidatedBy,\n            invalidatedBy,\n            token,\n            resolvedArg,\n            resolvedUri,\n            _args8 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _ref19 = _args8.length > 2 && _args8[2] !== undefined ? _args8[2] : {}, _ref19$invalidatedBy = _ref19.invalidatedBy, invalidatedBy = _ref19$invalidatedBy === void 0 ? new Set() : _ref19$invalidatedBy, token = _ref19.token;\n                _context8.next = 3;\n                return _resolveBareModuleReference2(this.resolver, href, fromHref, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                });\n\n              case 3:\n                resolvedArg = _context8.sent;\n\n                if (resolvedArg) {\n                  _context8.next = 6;\n                  break;\n                }\n\n                throw new ResolveError(href, fromHref);\n\n              case 6:\n                _context8.t0 = resolvedArg.resolvedSpec.type;\n                _context8.next = _context8.t0 === 'range' ? 9 : _context8.t0 === 'tag' ? 9 : _context8.t0 === 'version' ? 9 : 13;\n                break;\n\n              case 9:\n                _context8.next = 11;\n                return this.resolveBareModule(\"\".concat(resolvedArg.name, \"@\").concat(resolvedArg.resolvedSpec.fetchSpec), resolvedArg.pathname);\n\n              case 11:\n                resolvedUri = _context8.sent;\n                return _context8.abrupt(\"return\", this.resolveRelativeModuleReference(resolvedUri.href, fromHref, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                }));\n\n              case 13:\n                throw new NotSupportedError(\"Unsupported dependency type '\".concat(resolvedArg.resolvedSpec.type, \"' for '\").concat(href, \"'\").concat(fromHref ? \" from \".concat(fromHref) : ''));\n\n              case 14:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function resolveBareModuleReference(_x11, _x12) {\n        return _resolveBareModuleReference3.apply(this, arguments);\n      }\n\n      return resolveBareModuleReference;\n    }()\n  }, {\n    key: \"resolveRelativeModuleReference\",\n    value: function () {\n      var _resolveRelativeModuleReference = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee9(href, fromHref, _ref20) {\n        var invalidatedBy, token, combinedUri, resolveResult, resolvedUri, resolvedHref, rootHref;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                invalidatedBy = _ref20.invalidatedBy, token = _ref20.token;\n                combinedUri = new URL(href, fromHref);\n                _context9.next = 4;\n                return this.resolver.resolve(combinedUri, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                });\n\n              case 4:\n                resolveResult = _context9.sent;\n\n                if (!resolveResult.resolvedUrl) {\n                  resolvedUri = EMPTY_MODULE_URL;\n                } else {\n                  resolvedUri = resolveResult.resolvedUrl;\n                }\n\n                resolvedHref = resolvedUri.href;\n                rootHref = resolveResult.rootUrl.href;\n                return _context9.abrupt(\"return\", {\n                  type: Bundler.ResolveDetailsKind.Relative,\n                  ignored: resolveResult.ignored,\n                  invalidatedBy: invalidatedBy,\n                  resolvedHref: resolvedHref,\n                  rootHref: rootHref,\n                  stableHref: resolvedHref,\n                  stableRootHref: rootHref\n                });\n\n              case 9:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function resolveRelativeModuleReference(_x13, _x14, _x15) {\n        return _resolveRelativeModuleReference.apply(this, arguments);\n      }\n\n      return resolveRelativeModuleReference;\n    }()\n  }, {\n    key: \"resolveWithDetails\",\n    value: function () {\n      var _resolveWithDetails = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee10(uri, fromUri, _ref21) {\n        var _ref21$invalidatedBy, invalidatedBy, token;\n\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _ref21$invalidatedBy = _ref21.invalidatedBy, invalidatedBy = _ref21$invalidatedBy === void 0 ? new Set() : _ref21$invalidatedBy, token = _ref21.token;\n\n                if (!isBareModuleSpecifier(uri)) {\n                  _context10.next = 3;\n                  break;\n                }\n\n                return _context10.abrupt(\"return\", this.resolveBareModuleReference(uri, fromUri, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                }));\n\n              case 3:\n                return _context10.abrupt(\"return\", this.resolveRelativeModuleReference(uri, fromUri, {\n                  invalidatedBy: invalidatedBy,\n                  token: token\n                }));\n\n              case 4:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function resolveWithDetails(_x16, _x17, _x18) {\n        return _resolveWithDetails.apply(this, arguments);\n      }\n\n      return resolveWithDetails;\n    }()\n  }, {\n    key: \"onAssetAdded\",\n    get: function get() {\n      return this.onAssetAddedEmitter.event;\n    }\n  }, {\n    key: \"onAssetRemoved\",\n    get: function get() {\n      return this.onAssetRemovedEmitter.event;\n    }\n  }]);\n\n  return Bundler;\n}();\n\n(function (Bundler) {\n  var ResolveDetailsKind;\n\n  (function (ResolveDetailsKind) {\n    ResolveDetailsKind[\"BareModule\"] = \"bare_module\";\n    ResolveDetailsKind[\"Relative\"] = \"relative\";\n  })(ResolveDetailsKind = Bundler.ResolveDetailsKind || (Bundler.ResolveDetailsKind = {}));\n})(Bundler || (Bundler = {}));\n\nvar base64 = {\n  decode: Base64.decode,\n  encode: Base64.encode\n};\nexport { Asset, Bundle, Bundler, InvariantViolation, NotSupportedError, ResolveError, base64, getSourceMappingUrl };","import * as Monaco from 'monaco-editor';\nimport { useEffect, useState } from 'react';\nimport { DisposableStore } from 'ts-primitives';\n\n// import { EditorContext } from './context';\n\nexport enum EntryKind {\n  Directory = 'directory',\n  File = 'file',\n}\n\nexport interface IDirectory {\n  type: EntryKind.Directory;\n  uri: Monaco.Uri;\n}\nexport interface IFile {\n  type: EntryKind.File;\n  uri: Monaco.Uri;\n  model: Monaco.editor.ITextModel;\n}\n\nexport type DirectoryEntry = IDirectory | IFile;\n\nexport function useDirectory(uri: Monaco.Uri) {\n  // Make sure the URI always ends with a trailing slash\n  const prefix = uri.toString(true).replace(/\\/?$/, '/');\n  const sortEntries = (models: (DirectoryEntry)[]) => {\n    return [...models].sort((a, b) => (a.uri.fsPath > b.uri.fsPath ? 1 : -1));\n  };\n\n  const initialEntries = sortEntries(\n    Monaco.editor.getModels().reduce(\n      (entries, model) => {\n        const modelUri = model.uri.toString(true);\n\n        if (modelUri.startsWith(prefix)) {\n          const nestedPath = modelUri.slice(prefix.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const uri = Monaco.Uri.parse(`${prefix}${nestedPath.slice(0, nextDirIdx + 1)}`);\n\n            entries.push({\n              type: EntryKind.Directory,\n              uri,\n            });\n          } else {\n            entries.push({\n              type: EntryKind.File,\n              uri: model.uri,\n              model,\n            });\n          }\n        }\n\n        return entries;\n      },\n      [] as DirectoryEntry[]\n    )\n  );\n  const [entries, setEntries] = useState(initialEntries);\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n    const prefix = uri.toString(true).replace(/\\/?$/, '/');\n\n    disposable.add(\n      Monaco.editor.onDidCreateModel((model: Monaco.editor.ITextModel) => {\n        const modelUri = model.uri.toString(true);\n\n        if (modelUri.startsWith(prefix)) {\n          const nestedPath = modelUri.slice(prefix.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const uri = Monaco.Uri.parse(`${prefix}${nestedPath.slice(0, nextDirIdx)}`);\n\n            // It is possible that we already have this directory\n            const entry = entries.find(entry => entry.uri.toString(true) === uri.toString(true));\n\n            if (entry) {\n              if (entry.type !== EntryKind.Directory) {\n                throw new Error(\n                  `Invariant violation: A file in '${prefix}' conflicts with the path of the new file '${modelUri}'`\n                );\n              }\n\n              return;\n            }\n\n            entries.push({ type: EntryKind.Directory, uri });\n\n            return setEntries(sortEntries(entries));\n          }\n\n          if (\n            !entries.find(\n              entry => entry.type === EntryKind.File && entry.uri.toString(true) === model.uri.toString(true)\n            )\n          ) {\n            entries.push({ type: EntryKind.File, uri: model.uri, model });\n\n            setEntries(sortEntries(entries));\n          }\n        }\n      })\n    );\n\n    disposable.add(\n      Monaco.editor.onWillDisposeModel(model => {\n        const idx = entries.findIndex(entry => entry.type === EntryKind.File && entry.model === model);\n\n        if (idx === -1) {\n          throw new Error(`Invariant violation: Removing an untracked model: '${model.uri.fsPath}'`);\n        }\n\n        entries.splice(idx, 1);\n\n        setEntries(sortEntries(entries));\n      })\n    );\n\n    return () => disposable.dispose();\n  }, [entries, uri]);\n\n  return entries;\n}\n","import styled from '@emotion/styled/macro';\nimport { InvariantViolation } from '@velcro/bundler';\nimport { CanceledError } from '@velcro/resolver';\nimport * as Monaco from 'monaco-editor';\nimport React, { useEffect, useRef, useContext, useState } from 'react';\nimport {\n  Delayer,\n  Throttler,\n  DisposableStore,\n  CancellationTokenSource,\n  IDisposable,\n  Emitter,\n  Event,\n  timeout,\n  CancellationToken,\n} from 'ts-primitives';\n\nimport { EditorManagerContext } from '../lib/EditorManager';\nimport { TimeoutError } from '../lib/error';\nimport { HmrBuildErrorRequest, HmrReloadRequest, HmrReloadResponse } from '../lib/previewRuntime';\n\nexport interface DeferredExecutionModuleRecord {\n  code: string;\n  dependencies: Record<string, string>;\n}\n\nexport interface DeferredExecutionManifest {\n  aliases: Record<string, string>;\n  entrypoints: Record<string, string>;\n  modules: Record<string, DeferredExecutionModuleRecord>;\n}\n\ninterface MessageLine {\n  isInternal: boolean;\n  text: string;\n}\ninterface Message {\n  lines: MessageLine[];\n}\n\nconst PreviewProgress = styled.div<{ completed: number; total: number }>`\n  z-index: 1;\n  position: absolute;\n  top: 0;\n  width: ${props => (props.total ? `${Math.round((100 * props.completed) / props.total)}%` : 0)};\n  left: 0;\n  height: ${props => (props.total ? '2px' : '0')};\n  background-color: #008cba;\n  transition: width 0.5s 0s cubic-bezier(0.455, 0.03, 0.515, 0.955);\n`;\nconst PreviewIframeWrap = styled.div`\n  position: relative;\n  overflow: hidden;\n\n  & > iframe {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    border: none;\n    width: 100%;\n    height: 100%;\n  }\n`;\nconst PreviewWrap = styled.div`\n  position: relative;\n  background: white;\n\n  ${PreviewIframeWrap} {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n`;\nconst PreviewMessageError = styled.ul`\n  margin: 0;\n  padding: 1em 2em;\n  font-family: monospace;\n  font-size: 16px;\n  background-color: rgba(255, 0, 0, 0.5);\n  backdrop-filter: brightness(50%);\n  color: white;\n  list-style: none;\n`;\nconst PreviewMessageErrorText = styled.li<{ isInternal: boolean }>`\n  white-space: pre-wrap;\n  opacity: ${props => (props.isInternal ? 0.7 : 1.0)};\n`;\nconst PreviewMessages = styled.div`\n  z-index: 1;\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  display: flex;\n  flex-direction: column-reverse;\n`;\nconst PreviewMessageLine: React.FC<{ line: MessageLine }> = ({ line }) => {\n  return <PreviewMessageErrorText isInternal={line.isInternal}>{line.text}</PreviewMessageErrorText>;\n};\nconst PreviewMessage: React.FC<{ message: Message }> = ({ message }) => {\n  return message.lines.length ? (\n    <PreviewMessageError>\n      {message.lines.map((line, i) => (\n        <PreviewMessageLine key={i} line={line}></PreviewMessageLine>\n      ))}\n    </PreviewMessageError>\n  ) : null;\n};\n\nconst Preview: React.FC<{ className?: string }> = props => {\n  const invalidations = useRef(new Set<string>());\n  const previewWrapRef = useRef<HTMLDivElement | null>(null);\n  const hmrClientRef = useRef<HmrClient | null>(null);\n  const previewIframeRef = useRef<HTMLIFrameElement | null>(null);\n  const editorManager = useContext(EditorManagerContext);\n  const [messages, setMessages] = useState([] as Message[]);\n  const [buildProgress, setBuildProgress] = useState({ completed: 0, total: 0 });\n  const runtimeBundleString = useRef('');\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n    const delayer = new Delayer(500);\n    const throttler = new Throttler();\n\n    let building = true;\n    let tokenSource = new CancellationTokenSource();\n\n    const queueRefreshPreview = (uris: string[]) => {\n      tokenSource.cancel();\n      tokenSource.dispose();\n\n      tokenSource = new CancellationTokenSource();\n\n      for (const uri of uris) {\n        invalidations.current.add(uri);\n      }\n\n      delayer.trigger(() => throttler.queue(() => refreshPreview(tokenSource.token)));\n    };\n\n    const rerender = async (invalidate: string[], token: CancellationToken) => {\n      let runtimeBundle = runtimeBundleString.current;\n\n      try {\n        if (!runtimeBundle) {\n          const result = await editorManager.workerPeer.invoke(\n            'generateBundle',\n            [`memory:/preview/index.js`],\n            onEnqueueAsset,\n            onCompleteAsset,\n            {\n              executeEntrypoints: true,\n              // loggerLevel: 'debug',\n              sourceMap: false,\n            }\n          );\n          runtimeBundle = result.code;\n          runtimeBundleString.current = runtimeBundle;\n        }\n\n        let codeBundle: string;\n\n        try {\n          const unresolvedEntrypointHref = Monaco.Uri.file('/').toString(true);\n          const resolvedEntrypointHref = await editorManager.workerPeer.invoke('resolve', unresolvedEntrypointHref);\n\n          if (!resolvedEntrypointHref) {\n            throw new Error(`Unable to determine the entrypoing to your code`);\n          }\n\n          const result = await editorManager.workerPeer.invoke(\n            'generateBundle',\n            [resolvedEntrypointHref],\n            onEnqueueAsset,\n            onCompleteAsset,\n            {\n              executeEntrypoints: true,\n              invalidations: invalidate,\n              sourceMap: true,\n            }\n          );\n\n          codeBundle = result.code;\n        } catch (err) {\n          if (err.name === 'CanceledError') {\n            throw err;\n          }\n\n          codeBundle = `ReactErrorOverlay.reportBuildError(${JSON.stringify(err.message)});\\n`;\n        }\n\n        const runtimeBundleFile = new File([runtimeBundle], 'playground:///runtime.js', {\n          type: 'text/javascript',\n        });\n        const codeBundleFile = new File([`var __velcroRuntime = ${codeBundle};\\n`], 'playground:///index.js', {\n          type: 'text/javascript',\n        });\n        const markup = new File(\n          [\n            `\n  <!DOCTYPE html>\n  <html lang=\"en\">\n  <head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n  <title>Document</title>\n  <script src=\"${URL.createObjectURL(runtimeBundleFile)}\"></script>\n  </head>\n  <body>\n  <div id=\"root\"></div>\n  <script src=\"${URL.createObjectURL(codeBundleFile)}\"></script>\n  </body>\n  </html>`,\n          ],\n          Monaco.Uri.file('/index.html').toString(true),\n          {\n            type: 'text/html',\n          }\n        );\n        const htmlUrl = URL.createObjectURL(markup);\n        const iframe = document.createElement('iframe');\n        iframe.style.display = 'none';\n        iframe.src = htmlUrl;\n\n        if (previewWrapRef.current) {\n          previewWrapRef.current.appendChild(iframe);\n        }\n\n        try {\n          await new Promise((resolve, reject) => {\n            iframe.onload = () => resolve();\n            iframe.onerror = reject;\n          });\n        } catch (err) {\n          iframe.remove();\n          throw err;\n        }\n\n        if (previewIframeRef.current) {\n          previewIframeRef.current.remove();\n        }\n\n        iframe.style.display = '';\n\n        previewIframeRef.current = iframe;\n      } catch (err) {\n        tokenSource.cancel();\n\n        if (!(err instanceof CanceledError) && (err && err.name !== 'CanceledError')) {\n          setMessages(messages => [...messages, { lines: [{ isInternal: false, text: err.message }] }]);\n        }\n      } finally {\n        if (tokenSource) {\n          tokenSource.dispose();\n        }\n\n        building = false;\n\n        setBuildProgress({ completed: 0, total: 0 });\n      }\n    };\n\n    const hotReload = async (invalidate: string[], hmrClient: HmrClient, token: CancellationToken) => {\n      try {\n        const unresolvedEntrypointHref = Monaco.Uri.file('/').toString(true);\n        const resolvedEntrypointHref = await editorManager.workerPeer.invoke('resolve', unresolvedEntrypointHref);\n\n        if (!resolvedEntrypointHref) {\n          throw new Error(`Unable to determine the entrypoing to your code`);\n        }\n\n        const result = await editorManager.workerPeer.invoke(\n          'generateBundle',\n          [resolvedEntrypointHref],\n          onEnqueueAsset,\n          onCompleteAsset,\n          {\n            executeEntrypoints: false,\n            incremental: true,\n            invalidations: invalidate,\n            runtime: '__velcroRuntime',\n            sourceMap: true,\n          }\n        );\n        const updatedBundleFile = new File([result.code], 'playground:///runtime.js', {\n          type: 'text/javascript',\n        });\n        const updatedBundleHref = URL.createObjectURL(updatedBundleFile);\n\n        hmrClient.send({\n          type: 'reload',\n          invalidations: result.invalidations,\n          href: updatedBundleHref,\n        });\n\n        await Promise.race([\n          Event.toPromise(hmrClient.onReload),\n          timeout(5000).then(() => {\n            throw new TimeoutError(`HMR refresh timed out`);\n          }),\n        ]);\n      } catch (err) {\n        hmrClient.send({\n          type: 'build_error',\n          message: err.message,\n          stack: err.stack,\n        });\n      }\n    };\n\n    const refreshPreview = async (token: CancellationToken) => {\n      const refreshId = Date.now();\n      console.time(`Refresh ${refreshId}`);\n      const toInvalidate = Array.from(invalidations.current);\n\n      setMessages([]);\n\n      invalidations.current.clear();\n\n      building = true;\n      setBuildProgress({ completed: 0, total: 0 });\n\n      try {\n        if (!hmrClientRef.current) {\n          return await rerender(toInvalidate, token);\n        } else {\n          return await hotReload(toInvalidate, hmrClientRef.current, token);\n        }\n      } catch (err) {\n      } finally {\n        console.timeEnd(`Refresh ${refreshId}`);\n        building = false;\n        setBuildProgress({ completed: 0, total: 0 });\n      }\n    };\n\n    disposable.add(delayer);\n\n    const onEnqueueAsset = () => {\n      if (building) {\n        setBuildProgress(buildProgress => {\n          return {\n            completed: buildProgress.completed,\n            total: buildProgress.total + 1,\n          };\n        });\n      }\n    };\n    const onCompleteAsset = () => {\n      if (building) {\n        setBuildProgress(buildProgress => {\n          return {\n            completed: buildProgress.completed + 1,\n            total: buildProgress.total,\n          };\n        });\n      }\n    };\n\n    for (const model of Monaco.editor.getModels()) {\n      disposable.add(\n        model.onDidChangeContent(() => {\n          queueRefreshPreview([model.uri.toString(true)]);\n        })\n      );\n    }\n\n    disposable.add(\n      Monaco.editor.onDidCreateModel(model => {\n        queueRefreshPreview([model.uri.toString(true)]);\n\n        disposable.add(\n          model.onDidChangeContent(() => {\n            queueRefreshPreview([model.uri.toString(true)]);\n          })\n        );\n      })\n    );\n\n    disposable.add(\n      Monaco.editor.onWillDisposeModel(model => {\n        queueRefreshPreview([model.uri.toString(true)]);\n      })\n    );\n\n    disposable.add(\n      (() => {\n        const onMessage = async (e: MessageEvent) => {\n          if (\n            (previewIframeRef.current && e.source !== previewIframeRef.current.contentWindow) ||\n            !e.data ||\n            typeof e.data.type !== 'string' ||\n            !e.data.payload\n          ) {\n            return;\n          }\n\n          switch (e.data.type) {\n            case 'error_open': {\n              if (!editorManager.editor) {\n                return;\n              }\n\n              const model = editorManager.getModelByHref(e.data.payload.fileName);\n\n              if (model) {\n                let lineNumber: number | undefined = e.data.payload.lineNumber;\n                let columnNumber: number | undefined = undefined;\n\n                if (lineNumber !== undefined) {\n                  const row = model.getLineContent(lineNumber);\n                  const matches = row.match(/^(\\s*)/);\n\n                  columnNumber = matches ? matches[1].length + 1 : undefined;\n                }\n\n                editorManager.focusModel(model, {\n                  lineNumber,\n                  columnNumber,\n                });\n              }\n\n              break;\n            }\n            case 'hmr_ready': {\n              if (!(e.data.payload instanceof MessagePort)) {\n                console.warn(\n                  'Received \"hmr_ready\" message from preview but did not receive the expected MessagePort payload',\n                  e.data\n                );\n                return;\n              }\n\n              hmrClientRef.current = new HmrClient(e.data.payload);\n              break;\n            }\n            default: {\n              console.debug({ message: e.data }, 'Unknown message received from preview iframe');\n            }\n          }\n        };\n\n        window.addEventListener('message', onMessage);\n        return {\n          dispose() {\n            window.removeEventListener('message', onMessage);\n          },\n        };\n      })()\n    );\n\n    disposable.add({\n      dispose() {\n        if (hmrClientRef.current) {\n          hmrClientRef.current.dispose();\n        }\n      },\n    });\n\n    queueRefreshPreview([]);\n\n    return () => disposable.dispose();\n  }, [editorManager.workerPeer, editorManager, invalidations]);\n\n  return (\n    <PreviewWrap className={props.className}>\n      <PreviewProgress completed={buildProgress.completed} total={buildProgress.total}></PreviewProgress>\n      {previewIframeRef.current ? null : 'Building the preview...'}\n      <PreviewIframeWrap ref={previewWrapRef}></PreviewIframeWrap>\n      <PreviewMessages>\n        {messages.map((message, idx) => (\n          <PreviewMessage key={idx} message={message}></PreviewMessage>\n        ))}\n      </PreviewMessages>\n    </PreviewWrap>\n  );\n};\n\nexport default styled(Preview)``;\n\nclass HmrClient implements IDisposable {\n  private readonly onReloadEmitter = new Emitter<HmrReloadResponse>();\n\n  constructor(private readonly port: MessagePort) {\n    port.onmessage = e => {\n      if (!e.data || typeof e.data !== 'object') {\n        throw new InvariantViolation('Unexpected message received from HMR client');\n      }\n\n      switch (e.data.type) {\n        case 'reload': {\n          this.onReloadEmitter.fire(e.data);\n          break;\n        }\n        default: {\n          throw new InvariantViolation(`Unexpected message with type '${e.data.type}' received from HMR client`);\n        }\n      }\n    };\n  }\n\n  get onReload() {\n    return this.onReloadEmitter.event;\n  }\n\n  dispose() {\n    this.port.close();\n  }\n\n  send(message: HmrBuildErrorRequest | HmrReloadRequest) {\n    this.port.postMessage(message);\n  }\n}\n","import styled from '@emotion/styled/macro';\nimport * as Monaco from 'monaco-editor';\nimport React, { useContext, useRef } from 'react';\nimport { Button } from 'reakit/Button';\nimport { Tooltip, TooltipReference, useTooltipState } from 'reakit/Tooltip';\nimport { useDirectory, EntryKind } from '../lib/hooks';\nimport { useActiveModel, EditorManagerContext } from '../lib/EditorManager';\n\nconst Entry = styled.div<{ modelFocused: boolean }>`\n  background-color: ${props => (props.modelFocused ? '#008cba' : 'inherit')};\n  text-decoration: none;\n  color: ${props => (props.modelFocused ? '#fff' : '#262626')};\n\n  height: 25px;\n  padding: 0 0 0 8px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n\n  & > span {\n    flex: 1;\n  }\n\n  & > button {\n    display: none;\n  }\n\n  &:hover > button {\n    display: block;\n  }\n\n  ${props =>\n    props.modelFocused\n      ? {\n          ':hover': {\n            color: '#f5f5f5',\n            cursor: 'pointer',\n          },\n        }\n      : {\n          ':hover': {\n            backgroundColor: '#eee',\n            color: '#262626',\n            cursor: 'pointer',\n          },\n        }}\n`;\n\nconst CreateEntry = styled.div`\n  text-decoration: none;\n  color: '#262626';\n\n  height: 25px;\n  padding: 0 0 0 8px;\n  display: flex;\n  align-items: center;\n\n  :hover {\n    background-color: #eee;\n    cursor: pointer;\n  }\n`;\n\nconst SidebarFileDelete = styled(Button)`\n  border: none;\n  background: none;\n\n  :hover {\n    cursor: pointer;\n  }\n`;\n\nconst StyledTooltip = styled.div`\n  font-family: Open Sans, Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  line-height: 1.4;\n  background-color: #333;\n  color: #fff;\n  border-radius: 4px;\n  opacity: 0.9;\n  padding: 0.2em 0.4em;\n`;\n\nconst SidebarFile: React.FC<{ className?: string; model: Monaco.editor.ITextModel }> = ({ className, model }) => {\n  const activeModel = useActiveModel();\n  const editorManager = useContext(EditorManagerContext);\n  const tooltip = useTooltipState({ gutter: 0 });\n\n  const onClickDelete = () => {\n    model.dispose();\n  };\n\n  return (\n    <Entry className={className} modelFocused={model === activeModel}>\n      <span onClick={() => editorManager.focusModel(model)}>{model.uri.fsPath.slice(1)}</span>\n      <TooltipReference {...tooltip} as={SidebarFileDelete} onClick={() => onClickDelete()}>\n        <span role=\"img\" aria-label=\"Delete file\">\n          \n        </span>\n      </TooltipReference>\n      <Tooltip {...tooltip} as={StyledTooltip}>\n        Delete file\n      </Tooltip>\n    </Entry>\n  );\n};\n\nconst Sidebar: React.FC<{ className?: string }> = props => {\n  const rootDir = useRef(Monaco.Uri.file('/'));\n  const entries = useDirectory(rootDir.current);\n  const editorManager = useContext(EditorManagerContext);\n\n  const onClickCreate = () => {\n    const filename = prompt('Filename?');\n\n    if (filename) {\n      editorManager.createModel(filename);\n    }\n  };\n\n  return (\n    <div className={props.className}>\n      {entries.map(entry =>\n        entry.type === EntryKind.Directory ? (\n          <div>{entry.uri.fsPath.slice(1)}</div>\n        ) : (\n          <SidebarFile key={entry.uri.toString(true)} model={entry.model}></SidebarFile>\n        )\n      )}\n      <CreateEntry onClick={() => onClickCreate()}>Create...</CreateEntry>\n    </div>\n  );\n};\n\nexport default styled(Sidebar)`\n  display: flex;\n  flex-direction: column;\n`;\n","import styled from '@emotion/styled/macro';\nimport React from 'react';\n\nimport Editor from './Editor';\nimport Preview from './Preview';\nimport Sidebar from './Sidebar';\nimport { EditorManager, EditorManagerContext } from '../lib/EditorManager';\n\nconst PlaygroundCmp: React.FC<{ className?: string; initialPath: string; project: Record<string, string> }> = ({\n  className,\n  initialPath,\n  project,\n}) => {\n  const editorManager = new EditorManager({ files: project, initialPath: initialPath });\n\n  return (\n    <div className={className}>\n      <EditorManagerContext.Provider value={editorManager}>\n        <Sidebar></Sidebar>\n        <Editor></Editor>\n        <Preview></Preview>\n      </EditorManagerContext.Provider>\n    </div>\n  );\n};\n\nexport const Playground = styled(PlaygroundCmp)`\n  display: flex;\n  flex-direction: row;\n\n  font-family: Open Sans, Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  line-height: 1.4;\n\n  color: #222;\n\n  ${Sidebar} {\n    flex: 1 1 100px;\n    min-width: 100px;\n    max-width: 400px;\n    border-right: 1px solid #ccc;\n  }\n\n  ${Editor} {\n    border-right: 1px solid #ccc;\n  }\n\n  ${Editor}, ${Preview} {\n    flex: 10;\n  }\n`;\n","export const files = {\n  'package.json':\n    JSON.stringify(\n      {\n        dependencies: {\n          'github-markdown-css': '^3.0.1',\n          react: '^16.9.0',\n          'react-dom': '^16.9.0',\n        },\n      },\n      null,\n      2\n    ) + '\\n',\n  'app.jsx': `\nimport React, { Component } from 'react';\nimport 'github-markdown-css';\n\nimport { Explanation } from './explanation';\nimport { name } from './name';\nimport './style.css';\n\nclass Hello extends Component {\n  render() {\n    return <div className=\"markdown-body\">\n      <h1>Hello {name}</h1>\n      <blockquote>There is no <del>spoon</del> server</blockquote>\n      <Explanation/>\n    </div>;\n  }\n}\n\nexport default Hello\n  `.trim(),\n  'explanation.jsx':\n    `\nimport React from 'react';\n\nexport const Explanation = () => <>\n  <section>\n    <h2>What is this?</h2>\n    <p>\n      This is a demo of bundling and serving a browser-based sandbox fully from the browser. <strong>There are <em>no</em> servers involved</strong> except the static server hosting this demo and <a href=\"https://unpkg.com\" target=\"_blank\" rel=\"noopener\">unpkg.com</a>. All module resolution, transpilation and bundling is happening in the browser.\n    </p>\n    <p>\n      Try it. Go offline, and reload...\n    </p>\n    <p>\n      <strong>I dare you.</strong>\n    </p>\n  </section>\n  <section>\n    <h2>Features</h2>\n    <ul>\n      <li>Full offline support. Once your cache is seeded, you can cut the cord.</li>\n      <li>Fully browser-based bundling.</li>\n      <li>Add (almost) any node module and no server is involved.</li>\n      <li>If you want to add another module, make sure to add it to <code>package.json</code> first.</li>\n      <li>Automatic type acquisition for full typings support in the browser, in JavaScript!</li>\n      <li>Resolve source locations in stack traces</li>\n      <li>Hot module reloading</li>\n    </ul>\n  </section>\n</>;\n    `.trim() + '\\n',\n  'index.jsx':\n    `\nimport React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './app';\n  \nReactDOM.render(\n  <App/>,\n  document.getElementById('root')\n);\n      `.trim() + '\\n',\n  'name.js':\n    `\nexport const name = 'Velcro';\n    `.trim() + '\\n',\n  'style.css':\n    `\n.markdown-body {\n  box-sizing: border-box;\n  min-width: 200px;\n  max-width: 980px;\n  margin: 0 auto;\n  padding: 45px;\n}\n\n@media (max-width: 767px) {\n  .markdown-body {\n    padding: 15px;\n  }\n}\n    `.trim() + '\\n',\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n\n      navigator.serviceWorker.ready.then(registration => {\n        config && config.onSuccess && config.onSuccess(registration);\n      });\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\n\nimport * as serviceWorker from './serviceWorker';\n\ninterface ServiceWorkerEvent extends Event {\n  target: Partial<ServiceWorker> & EventTarget | null;\n}\n\ninterface ServiceWorkerContextValue {\n  assetsUpdateReady: boolean;\n  assetsCached: boolean;\n  updateAssets(): void;\n}\n\nconst ServiceWorkerContext = React.createContext<ServiceWorkerContextValue | undefined>(undefined);\n\nexport function ServiceWorkerProvider(props: React.PropsWithChildren<{}>) {\n  const [waitingServiceWorker, setWaitingServiceWorker] = React.useState<ServiceWorker | null>(null);\n  const [assetsUpdateReady, setAssetsUpdateReady] = React.useState(false);\n  const [assetsCached, setAssetsCached] = React.useState(false);\n\n  const value = React.useMemo(() => {\n    return {\n      assetsUpdateReady,\n      assetsCached,\n      // Call when the user confirm update of application and reload page\n      updateAssets: () => {\n        if (waitingServiceWorker) {\n          waitingServiceWorker.addEventListener('statechange', (event: ServiceWorkerEvent) => {\n            if (event.target && event.target.state === 'activated') {\n              window.location.reload();\n            }\n          });\n\n          waitingServiceWorker.postMessage({ type: 'SKIP_WAITING' });\n        }\n      },\n    };\n  }, [assetsUpdateReady, assetsCached, waitingServiceWorker]);\n\n  // Once on component mounted subscribe to Update and Succes events in\n  // CRA's service worker wrapper\n  React.useEffect(() => {\n    serviceWorker.register({\n      onUpdate: registration => {\n        setWaitingServiceWorker(registration.waiting);\n        setAssetsUpdateReady(true);\n      },\n      onSuccess: registration => {\n        setAssetsCached(true);\n\n        if (registration.active) {\n          registration.active.addEventListener('statechange', (event: ServiceWorkerEvent) => {\n            if (!navigator.serviceWorker.controller) {\n              setAssetsCached(false);\n            }\n          });\n        }\n      },\n    });\n  }, []);\n\n  return <ServiceWorkerContext.Provider value={value} {...props} />;\n}\n\nexport function useServiceWorker() {\n  const context = React.useContext(ServiceWorkerContext);\n\n  if (!context) {\n    throw new Error('useServiceWorker must be used within a ServiceWorkerProvider');\n  }\n\n  return context;\n}\n","import { Global, css } from '@emotion/core';\nimport styled from '@emotion/styled/macro';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { OfflineBolt, Update } from '@material-ui/icons';\nimport React from 'react';\nimport { Tooltip, TooltipReference, useTooltipState } from 'reakit/Tooltip';\n\nimport { Playground } from './playground';\nimport { files } from './templates/react';\nimport { useServiceWorker, ServiceWorkerProvider } from './useServiceWorker';\nimport { Button } from 'reakit/Button';\n\nconst PlaygroundWrapper = styled.div`\n  background: white;\n  color: #666;\n  display: flex;\n  flex-direction: column;\n\n  ${Playground} {\n    border-bottom: 1px solid #ccc;\n    flex: 1;\n  }\n`;\n\nconst StatusBarItem = styled.span`\n  display: inline-flex;\n  flex-direction: row;\n  align-items: center;\n`;\n\nconst ReloadButton = styled(Button)`\n  border: 0;\n  background: #008cba;\n  margin: 0 0.5em;\n  color: white;\n  border-radius: 2px;\n  font-weight: 600;\n\n  :hover {\n    cursor: pointer;\n    text-decoration: underline;\n  }\n`;\n\nconst StyledTooltip = styled.div`\n  font-family: Open Sans, Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  line-height: 1.4;\n  background-color: #333;\n  color: #fff;\n  border-radius: 4px;\n  opacity: 0.9;\n  padding: 0.2em 0.4em;\n`;\n\nconst StatusBar: React.FC = () => {\n  const serviceWorker = useServiceWorker();\n  const offlineTooltip = useTooltipState({ gutter: 0 });\n  const reloadTooltip = useTooltipState({ gutter: 0 });\n\n  return (\n    <StatusBarStyles>\n      {serviceWorker.assetsCached ? (\n        <TooltipReference {...offlineTooltip} as={StatusBarItem}>\n          <OfflineBolt color=\"inherit\" fontSize=\"small\" />\n          &nbsp;Offline ready\n        </TooltipReference>\n      ) : null}\n      <Tooltip {...offlineTooltip} as={StyledTooltip}>\n        This application has been fully cached and can now be used offline.\n      </Tooltip>\n\n      {serviceWorker.assetsUpdateReady ? (\n        <TooltipReference {...reloadTooltip} as={StatusBarItem}>\n          <Update color=\"inherit\" fontSize=\"small\" />\n          &nbsp;Update ready:\n          <ReloadButton onClick={() => serviceWorker.updateAssets()}>Reload</ReloadButton>\n        </TooltipReference>\n      ) : null}\n      <Tooltip {...reloadTooltip} as={StyledTooltip}>\n        There is an update of this application ready to install. Click install reload to install the update and reload\n        the page.\n      </Tooltip>\n    </StatusBarStyles>\n  );\n};\n\nconst StatusBarStyles = styled.div`\n  display: flex;\n  flex-direction: row;\n\n  font-size: 90%;\n\n  height: 24px;\n  padding: 0 0.5em;\n\n  ${StatusBarItem} {\n    margin-left: 0.5em;\n    margin-right: 0.5em;\n  }\n`;\n\nconst AppWrapper = styled.div`\n  width: 100%;\n  min-width: 200px;\n  max-width: 80vw;\n  margin: 0 auto;\n  padding: 0 0 45px 0;\n\n  @media (max-width: 960px) {\n    padding: 0 15px 15px 15px;\n    max-width: initial;\n  }\n\n  display: flex;\n  flex-direction: column;\n\n  ${PlaygroundWrapper} {\n    flex: 1;\n    background: #f5f5f5;\n    border-radius: 2px;\n    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);\n\n    ${StatusBarStyles} {\n    }\n  }\n`;\n\nconst Title = styled.div`\n  font-family: 'Raleway', sans-serif;\n  font-size: 250%;\n  font-weight: 800;\n  font-variant: small-caps;\n  font-variant-caps: small-caps;\n  color: #00bfff;\n`;\n\nconst Subtitle = styled.div`\n  color: #ddd;\n  font-size: 120%;\n  font-weight: 400;\n`;\n\nconst Link = styled.a`\n  color: white;\n  text-decoration: none;\n\n  :hover {\n    text-decoration: underline;\n  }\n`;\n\nconst Links = styled.div`\n  display: flex;\n  flex-direction: row;\n\n  & > *:not(:last-child):after {\n    padding: 0 0.5em;\n    content: '';\n    color: #aaa;\n    text-decoration: none;\n  }\n\n  ${Link} {\n    color: #ccc;\n  }\n`;\n\nconst Header = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: baseline;\n  padding: 0.8em 0 0.3em 0;\n  text-shadow: #000 1px 1px 5px;\n\n  ${Title} {\n    margin-right: 0.5em;\n  }\n\n  ${Subtitle} {\n    margin-right: 0.5em;\n  }\n\n  ${Links} {\n    flex: 1;\n    justify-content: flex-end;\n  }\n`;\n\nconst globalCss = css`\n  @import url('https://fonts.googleapis.com/css?family=Raleway:900&display=swap');\n\n  *,\n  *::before,\n  *::after {\n    box-sizing: border-box;\n  }\n\n  html,\n  body {\n    margin: 0;\n    padding: 0;\n    min-height: 100vh;\n\n    font-family: Open Sans, Helvetica Neue, Helvetica, Arial, sans-serif;\n    font-size: 14px;\n    line-height: 1.4;\n\n    background: #333;\n    color: #fff;\n\n    display: flex;\n    flex-direction: column;\n\n    #root {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n\n      ${AppWrapper} {\n        flex: 1;\n      }\n    }\n  }\n`;\n\nexport const App: React.FC = () => {\n  return (\n    <ServiceWorkerProvider>\n      <CssBaseline />\n      <AppWrapper>\n        <Global styles={globalCss}></Global>\n        <Header>\n          <Title>Velcro</Title>\n          <Subtitle>The client-side bundler and playground</Subtitle>\n          <Links>\n            <div>\n              <Link href=\"https://twitter.com/filearts\" target=\"_blank\" rel=\"nofollow noreferrer\">\n                @filearts\n              </Link>\n            </div>\n            <div>\n              <Link href=\"https://github.com/ggoodman/velcro\" target=\"_blank\" rel=\"nofollow noreferrer\">\n                View on GitHub\n              </Link>\n            </div>\n          </Links>\n        </Header>\n        <PlaygroundWrapper>\n          <Playground project={files} initialPath=\"index.jsx\"></Playground>\n          <StatusBar></StatusBar>\n        </PlaygroundWrapper>\n      </AppWrapper>\n    </ServiceWorkerProvider>\n  );\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { App } from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}